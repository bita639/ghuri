var $bm=function(){var nativeEvents=["change","click","mouseover","mouseout","keydown","load","keyup","mousemove","touchmove","scroll","ontouchstart","focusout"],customEvents=[],loadedJSLists=[],loadedCSSLists=[];var cancelxmlHttp=new XMLHttpRequest;var Constructor=function(selector){if(selector==="document"){this.elems=[document]}else if(selector==="window"){this.elems=[window]}else{this.elems=document.querySelectorAll(selector)}};var instantiate=function(selector){return new Constructor(selector)};Constructor.prototype.each=function(callback){if(!callback||typeof callback!=="function")return;for(var i=0;i<this.elems.length;i++){callback(this.elems[i],i)}return this};Constructor.prototype.postAjax=function(url,data,success,content_type){var content_type=typeof content_type!="undefined"?content_type:"application/x-www-form-urlencoded";var params=typeof data!="object"?data:Object.keys(data).map(function(k){return encodeURIComponent(k)+"="+encodeURIComponent(data[k])}).join("&");if(content_type=="application/json;charset=UTF-8"){params=JSON.stringify(data)}var xhr=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");xhr.open("POST.html",url);xhr.onreadystatechange=function(){if(xhr.readyState>3&&xhr.status==200){success(xhr.responseText)}};xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.setRequestHeader("Content-Type",content_type);xhr.send(params);return xhr};Constructor.prototype.addListener=function(type,func){type=type=="touchmove"&&!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform)?"scroll":type;if(nativeEvents.indexOf(type)>-1){this.each(function(item){item.addEventListener(type,func,false)})}return this};Constructor.prototype.removeListener=function(type,func){if(nativeEvents.indexOf(type)>-1){this.each(function(item){item.removeEventListener(type,func,false)})}return this};Constructor.prototype.get=function(url,callback){return httpGetAsync(url,callback);function httpGetAsync(url,callback){var xmlHttp=new XMLHttpRequest;xmlHttp.onreadystatechange=function(){if(xmlHttp.readyState==4&&xmlHttp.status==200)callback(xmlHttp.responseText)};xmlHttp.open("GET.html",url,true);xmlHttp.send(null)}};Constructor.prototype.cancellerableget=function(url,callback){return httpGetAsync(url,callback);function httpGetAsync(url,callback){if(cancelxmlHttp&&cancelxmlHttp.readystate!=4){cancelxmlHttp.abort()}cancelxmlHttp.onreadystatechange=function(){if(cancelxmlHttp.readyState==4&&cancelxmlHttp.status==200)callback(cancelxmlHttp.responseText)};cancelxmlHttp.open("GET.html",url,true);cancelxmlHttp.send(null)}};Constructor.prototype.injectDOM=function(){try{var attribute=arguments[0];var dom=arguments[1];var type=!!arguments[2]?arguments[2]:"replace";var domView=document.querySelector(attribute);if(domView){type=="append"?domView.innerHTML+=domView?dom:"":domView.innerHTML=domView?dom:""}}catch(e){throw e}return this};Constructor.prototype.getInjectDOM=function(){try{var self=this;var url=arguments[0];var attribute=arguments[1];var domtype=arguments[2]||null;var callback=arguments[3]||undefined;var canceller=arguments[4]||false;canceller?this.cancellerableget(url,function(res){self.injectDOM(attribute,res,domtype);!!callback&&callback(res)}):this.get(url,function(res){self.injectDOM(attribute,res,domtype);!!callback&&callback(res)})}catch(e){throw e}};Constructor.prototype.loadJS=function(){var source=arguments[0];var callback=arguments[1];var rePull=arguments[2]||false;try{if(loadedJSLists.indexOf(source)>-1&&!rePull)return callback();var script=document.createElement("script");var prior=document.getElementsByTagName("script")[0];script.async=1;script.onload=script.onreadystatechange=function(_,isAbort){if(isAbort||!script.readyState||/loaded|complete/.test(script.readyState)){script.onload=script.onreadystatechange=null;script=undefined;if(!isAbort&&callback){loadedJSLists.push(source);setTimeout(callback,0)}}};script.src=source;prior.parentNode.insertBefore(script,prior)}catch(e){throw e}};Constructor.prototype.loadCSS=function(path,callback){try{if(loadedCSSLists.indexOf(path)>-1)return callback();var head=document.getElementsByTagName("head")[0],link=document.createElement("link");link.setAttribute("href",path);link.setAttribute("rel","stylesheet");link.setAttribute("type","text/css");var sheet,cssRules;if("sheet"in link){sheet="sheet";cssRules="cssRules"}else{sheet="styleSheet";cssRules="rules"}head.appendChild(link);loadedCSSLists.push(path);callback()}catch(e){throw e}};Constructor.prototype.getInputValue=function(){var values=[];this.each(function(item){values.push(item.value)});return values};Constructor.prototype.removeClass=function(str){this.each(function(item){str?item.classList.remove(str):item.className=""})};Constructor.prototype.addClass=function(str){this.each(function(item){item.classList.add(str)})};Constructor.prototype.toggleClass=function(str){this.each(function(item){item.classList.toggle(str)})};Constructor.prototype.removeDOM=function(){this.each(function(item){item.remove()})};Constructor.prototype.focus=function(){this.each(function(item){item.focus()})};Constructor.prototype.isInViewport=function(callback){this.each(function(item){callback(helpers("viewport",item))})};Constructor.prototype.isInViewportWithEvent=function(callback){this.each(function(item){callback(helpers("viewport",item),item)})};Constructor.prototype.showDOM=function(){this.each(function(item){item.style.display="block"})};Constructor.prototype.hideDOM=function(){this.each(function(item){item.style.display="none"})};Constructor.prototype.fadeOut=function(){this.each(function(item){item.style.transition="opacity 400ms ease";setTimeout(function(){item.style.opacity=0},20);setTimeout(function(){item.style.display="none"},420)})};Constructor.prototype.fadeIn=function(){this.each(function(item){item.style.opacity=0;item.style.display="block";item.style.transition="opacity 400ms ease";setTimeout(function(){item.style.opacity=1},20)})};Constructor.prototype.toggleDom=function(){this.each(function(item){item.style.display=item.style.display=="block"?"none":"block"})};Constructor.prototype.toggleDomWithValue=function(value){this.each(function(item){item.style.display=value})};Constructor.prototype.showDOMInline=function(){this.each(function(item){item.style.display="inline-block"})};Constructor.prototype.changeInnerText=function(str,supportHTML){this.each(function(item){if(supportHTML==true){item.innerHTML=str}else item.innerText=str})};Constructor.prototype.hasClass=function(classname){var hasCls=false;this.each(function(item){hasCls=item.className.split(/\s/).indexOf(classname)>=0});return hasCls};Constructor.prototype.setAttribute=function(attribute,value){this.each(function(item){item.setAttribute(attribute,value)})};Constructor.prototype.getDataSets=function(){var datasets=[];this.each(function(item){datasets.push(Object.assign({},item.dataset))});return datasets};Constructor.prototype.click=function(){this.each(function(item){try{item.click()}catch(e){console.log(e)}})};Constructor.prototype.children=function(){var res=[];this.each(function(item){res=item.children});return res};Constructor.prototype.watch=function(object,key,callback){object.watch(""+key,function(id,oldval,newval){callback(id,oldval,newval)})};Constructor.prototype.unwatch=function(object,key){object.unwatch(""+key)};var helpers=function(){var viewport=function(arguments){try{var el=arguments[1];if(el){var top=el.offsetTop;var left=el.offsetLeft;var width=el.offsetWidth;var height=el.offsetHeight;while(el.offsetParent){el=el.offsetParent;top+=el.offsetTop;left+=el.offsetLeft}return top<window.pageYOffset+window.innerHeight&&left<window.pageXOffset+window.innerWidth&&top+height>window.pageYOffset&&left+width>window.pageXOffset}return false}catch(e){throw e}};try{return eval(arguments[0])(arguments)}catch(e){throw e}};return instantiate}();if(!Object.prototype.watch){Object.defineProperty(Object.prototype,"watch",{enumerable:false,configurable:true,writable:false,value:function(prop,handler){var oldval=this[prop],newval=oldval,getter=function(){return newval},setter=function(val){oldval=newval;return newval=handler.call(this,prop,oldval,val)};if(delete this[prop]){Object.defineProperty(this,prop,{get:getter,set:setter,enumerable:true,configurable:true})}}})}if(!Object.prototype.unwatch){Object.defineProperty(Object.prototype,"unwatch",{enumerable:false,configurable:true,writable:false,value:function(prop){var val=this[prop];delete this[prop];this[prop]=val}})}var BMScrollTo={documentVerticalScrollPosition:function(){if(self.pageYOffset)return self.pageYOffset;if(document.documentElement&&document.documentElement.scrollTop)return document.documentElement.scrollTop;if(document.body.scrollTop)return document.body.scrollTop;return 0},viewportHeight:function(){return document.compatMode==="CSS1Compat"?document.documentElement.clientHeight:document.body.clientHeight},documentHeight:function(){return document.height!==undefined?document.height:document.body.offsetHeight},documentMaximumScrollPosition:function(){return this.documentHeight()-this.viewportHeight()},elementVerticalClientPositionById:function(id){var element=document.getElementById(id);var rectangle=element.getBoundingClientRect();return rectangle.top},scrollVerticalTickToPosition:function(currentPosition,targetPosition){var filter=.2;var fps=60;var difference=parseFloat(targetPosition)-parseFloat(currentPosition);var arrived=Math.abs(difference)<=.5;if(arrived){scrollTo(0,targetPosition);return}currentPosition=parseFloat(currentPosition)*(1-filter)+parseFloat(targetPosition)*filter;scrollTo(0,Math.round(currentPosition));setTimeout("BMScrollTo.scrollVerticalTickToPosition("+currentPosition+", "+targetPosition+")",1e3/fps)},scrollVerticalToElementById:function(id,padding){var element=document.getElementById(id);if(element==null){console.warn("Cannot find element with id '"+id+"'.");return}var targetPosition=this.documentVerticalScrollPosition()+this.elementVerticalClientPositionById(id)-padding;var currentPosition=this.documentVerticalScrollPosition();var maximumScrollPosition=this.documentMaximumScrollPosition();if(targetPosition>maximumScrollPosition)targetPosition=maximumScrollPosition;this.scrollVerticalTickToPosition(currentPosition,targetPosition)}};;"use strict";var injectAction;function GlobalSearch(){this.login_url=baseUrl+"/user/login?redirect=1";this.isUserLogin=user_is!="";this.loadingViewContent=null;this.loadingView=document.getElementById("loading_spinner")||undefined;this.notificationView='<div class="noti {{type}}">{{content}}<a href="javascript:void(0)" class="noti-close" id="mbl-noti-close"><span class="icon-cross97"></span></a></div>';this.loginJSUrl=baseUrl+"/js/app/loginInit.js?v=6";this.user={isLogin:this.isUserLogin};this.isMobile=isMobile?1:0;this.user_id=null;this.baseUrl=baseUrl}GlobalSearch.prototype.init=function(){$bm("#mbl-login-button").addListener("click",function(e){e.preventDefault();global.openLogin()})};GlobalSearch.prototype.openLogin=function(){if(!this.isMobile){handleLoginClickEvent()}else{global.loadingViewContent="<i>Please wait</i>";global.loadinViewAction();$bm("document").loadJS(global.loginJSUrl,function(){injectAction=new InjectAction;injectAction.isMobile=true;injectAction.initialize(baseUrl+"/js/app/login.js?v=19",function(){!!injectAction.loginFileInjected&&injectAction.showModal()})})}};GlobalSearch.prototype.goto=function(url){window.location=url};GlobalSearch.prototype.showNotification=function(type,content){var notificationView=this.notificationView;notificationView=notificationView.replace("{{type}}",type);notificationView=notificationView.replace("{{content}}",content);$bm("#noti-view").injectDOM("#noti-view",notificationView,"append")};GlobalSearch.prototype.hideNotification=function(){if(!!document.querySelector("#noti-view > div")){document.querySelector("#noti-view > div").remove()}};GlobalSearch.prototype.loadinViewAction=function(type){if(!!this.loadingView){type=typeof type=="undefined"?"add":type;if(type=="add"&&this.loadingViewContent){this.loadingView.innerHTML='<span class="spinner-circle"></span>'+this.loadingViewContent}this.loadingView.style.display=type=="remove"?"none":"block";if(this.loadingViewContent&&type=="remove"){global=new GlobalSearch}}};GlobalSearch.prototype.watchLoginStatus=function(){$bm("document").watch(global.user,"isLogin",function(id,oldval,newval){oldval==false&&newval==true&&profileDropView.updateUserProfileDropDown();newval==true&&$bm("document").unwatch(global.user,"isLogin")})};GlobalSearch.prototype.setUserLoginStatus=function(status){global.user.isLogin=status};var global=new GlobalSearch;global.init();global.watchLoginStatus();function SeachDropdown(){this.choosen=-1;this.limit=0;this.goto=null}SeachDropdown.prototype.listen=function(){var self=this;$bm("[type=search]").addListener("keydown",function(e){e.keyCode==40&&self.action("down");e.keyCode==38&&self.action("up");e.keyCode==13&&self.action("enter")})};SeachDropdown.prototype.action=function(type){if(type=="down"){if(this.choosen<this.limit-1){this.choosen=this.choosen==-1?0:this.choosen+1;var deSelectChoosen=this.choosen>0?this.choosen-1:null;deSelectChoosen>-1&&$bm('[data-search-key="'+deSelectChoosen+'"]').removeClass("selected");$bm('[data-search-key="'+this.choosen+'"]').addClass("selected")}}if(type=="up"){if(this.choosen>-1){this.choosen=this.choosen-1;var deSelectChoosen=this.choosen+1;deSelectChoosen>-1&&$bm('[data-search-key="'+deSelectChoosen+'"]').removeClass("selected");$bm('[data-search-key="'+this.choosen+'"]').addClass("selected")}}var enterDom=document.querySelector('[data-search-key="'+this.choosen+'"]');if(this.choosen>-1&&enterDom){searchDropDown.goto=enterDom.href;type=="enter"&&global.goto(searchDropDown.goto)}else{searchDropDown.goto=null}};var searchDropDown=new SeachDropdown;searchDropDown.listen();var searchButton=$bm("#mbl-search-icon");var searchInput=null;searchButton.addListener("click",pullSearchView);function pullSearchView(event){event.preventDefault();searchButton.injectDOM(".top-search-form",searchFormView.sView,"replace");try{searchInput=document.querySelector("input[type=search]");searchInput.value=event.target.dataset.queryValue;$bm("#mbl-query-search-btn").addListener("click",searchFormView.searchQueryButtonClicked)}catch(e){}searchFormView.hideShow()}var searchFormView=new SearchFormView;function SearchFormView(){this.sView='<div class="search-input"><input type="search" class="form-control" placeholder="Search"></div><button type="submit" value="Search" id="mbl-query-search-btn"><span class="icon-search icon-magnifying-glass"></span></button><div class="suggestions-dropdown" id="mbl-suggestions-dropdown"><div class="suggestions-holder"><div class="spinner-circle" id="mbl-bar-suggestion-spinner" style="display: none;"></div><div id="mbl-top-bar-suggestions"></div></div></div>';this.suggestions=[];this.suggestionDOM=$bm(".suggestions-dropdown");if(document.getElementById("mbl-suggestions-dropdown")&&global.isMobile)document.getElementById("mbl-suggestions-dropdown").style.display="block";this.oldSeachText=""}SearchFormView.prototype.blockSubmitDesktopOnly=function(){$bm("#mbl-query-search-btn").addListener("click",searchFormView.searchQueryButtonClicked)};SearchFormView.prototype.hideShow=function(){$bm(".top-search-form").toggleClass("active");$bm("[type=search]").focus()};SearchFormView.prototype.searchQueryButtonClicked=function(event){event.preventDefault();var q=document.querySelector("input[type=search]").value;var len=q.replace(/\s/g,"").length;if(len>0){var url=searchDropDown.goto?searchDropDown.goto:baseUrl+"?q="+q.replace(/\s/g,"+");searchDropDown.goto=null;global.goto(url)}};SearchFormView.prototype.getSuggestions=function(query,type){this.oldSeachText=query;var len=query.replace(/\s/g,"").length;var self=this;if(!global.isMobile){document.getElementById("mbl-suggestions-dropdown").style.display=len>3?"block":"none"}if(type=="notrip"){if(len>=3){this.suggestionSpinner("block");var url=baseUrl+"/dom/getsuggestiondommbl?query="+query+"&notrip=1";$bm("#mbl-suggestion-holder").getInjectDOM(url,"#mbl-suggestion-holder","replace",function(res){self.suggestionSpinner("none");searchDropDown.limit=$bm("[data-search-key]").elems.length;document.getElementById("mbl-suggestions-dropdown").style.display="block"},true)}else{this.hideSuggestionBox(type)}}if(type=="bar"){if(len>=3){this.barSuggestionSpinner("block");var url=baseUrl+"/dom/getsuggestiondommbl?query="+query;$bm("#mbl-top-bar-suggestions").getInjectDOM(url,"#mbl-top-bar-suggestions","replace",function(res){self.barSuggestionSpinner("none");searchDropDown.limit=$bm("[data-search-key]").elems.length;document.getElementById("mbl-suggestions-dropdown").style.display="block"},true)}else{this.hideSuggestionBox(type);self.barSuggestionSpinner("none")}}};SearchFormView.prototype.suggestionSpinner=function(type){if(document.getElementById("mbl-suggestion-spinner"))document.getElementById("mbl-suggestion-spinner").style.display=type};SearchFormView.prototype.barSuggestionSpinner=function(type){if(document.getElementById("mbl-bar-suggestion-spinner")){document.getElementById("mbl-bar-suggestion-spinner").style.display=type;if(type=="block"){$bm("#mbl-suggestions-dropdown").addClass("loading")}else{$bm("#mbl-suggestions-dropdown").removeClass("loading")}}};SearchFormView.prototype.hideSuggestionBox=function(type){type=="notrip"&&$bm("#mbl-suggestion-holder").injectDOM("#mbl-suggestion-holder","","replace");type=="bar"&&$bm("#mbl-top-bar-suggestions").injectDOM("#mbl-top-bar-suggestions","","replace")};$bm("#mbl-home-search-button2").addListener("click",function(e){e.preventDefault();var q=document.getElementById("no-trip-input")?document.getElementById("no-trip-input").value:document.querySelector("input[type=search-no-trip]").value;makeBarSearch(q)});function makeBarSearch(q){var len=q.replace(/\s/g,"").length;if(len>0){var url=baseUrl+"?q="+q.replace(/\s/g,"+");global.goto(url)}}$bm("#no-trip-input").addListener("keydown",function(e){var key=e.which||e.keyCode;if(key===13&&!searchDropDown.goto){var q=e.target.value;makeBarSearch(q)}});document.addEventListener("keyup",function(e){if(e.target.id=="no-trip-input"&&searchFormView.oldSeachText!=e.target.value){searchFormView.getSuggestions(e.target.value,"notrip");return}if(e.target.type=="search"&&searchFormView.oldSeachText!=e.target.value){searchFormView.getSuggestions(e.target.value,"bar")}e.stopPropagation()});searchFormView.suggestionSpinner("none");!global.isMobile&&searchFormView.blockSubmitDesktopOnly();function ProfileDropView(){this.loading=false;this.dom=null;this.profileDropDownButton=null;this.dropdownUrl=global.isMobile?baseUrl+"/dom/mobileprofiledropdown":baseUrl+"/dom/desktopprofiledropdown"}ProfileDropView.prototype.dropDown=function(inject){this.loading=true;try{var self=this;!this.dom&&this.pull(function(){inject&&self.showHide()});this.dom&&inject&&self.showHide();this.loading=!inject?false:this.loading}catch(e){console.log(e)}};function pullProfileDropDownOnMove(){$bm("document").removeListener("mousemove",pullProfileDropDownOnMove);profileDropView.pull(function(){})}ProfileDropView.prototype.pull=function(callback){var self=this;this.profileDropDownButton.getInjectDOM(this.dropdownUrl,"#mbl-p-dropdown","replace",function(res){self.dom=res;typeof callback=="function"?callback():void 0})};ProfileDropView.prototype.init=function(){this.profileDropDownButton=$bm("#mbl-user-profile-dropwdown-view");$bm("document").addListener("mousemove",pullProfileDropDownOnMove);this.profileDropDownButton.addListener("click",function(event){!profileDropView.loading&&profileDropView.dropDown(true)});$bm("document").addListener("touchmove",profileDropViewPull)};ProfileDropView.prototype.showHide=function(){this.loading=false;$bm("#mbl-user-profile-dropwdown-view").toggleClass("active");$bm(".prof").toggleClass("active")};ProfileDropView.prototype.hide=function(){this.loading=false;$bm("#mbl-user-profile-dropwdown-view").removeClass("active");$bm(".prof").removeClass("active")};ProfileDropView.prototype.updateUserProfileDropDown=function(){var url=baseUrl+"/dom/logindom?m="+global.isMobile;var oldDom=document.getElementById("mbl-non-login-header");!global.isMobile&&oldDom.classList.add("prof");$bm("document").get(url,function(res){var response=JSON.parse(res);mychannel="channel_"+response.id;if(!!global){global.user_id=response.id}typeof PusherConnect=="function"&&PusherConnect();profileDropView.loading=false;$bm("document").injectDOM("#mbl-non-login-header",response.dom,"replace");if(!global.isMobile&&response.mdom){$bm("document").injectDOM("#link-register-header",response.mdom,"replace")}setTimeout(function(){profileDropView.init()},100)})};function profileDropViewPull(){!profileDropView.loading&&profileDropView.dropDown(false);$bm("document").removeListener("touchmove",profileDropViewPull)}var profileDropView=new ProfileDropView;global.isUserLogin&&profileDropView.init();function Footer(){}Footer.prototype.injectDOM=function(){var self=this;$bm("#mbl-footer-right").getInjectDOM(baseUrl+"/dom/mobilefooterview","#mbl-footer-right","replace",function(res){loadFBTwitter();footer.addCurrencyEventListener();emailSubs.listenInput()})};Footer.prototype.addCurrencyEventListener=function(){setTimeout(function(){currencyPicker.injectOptionDom()},500);reInitListenActions()};reInitListenActions();function reInitListenActions(){setTimeout(function(){if(is_touch_device()){document.addEventListener("touchstart",universalHandler,false)}else{document.addEventListener("click",universalHandler,false)}document.addEventListener("click",customHandler,false)},500)}function is_touch_device(){return"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0}var currencyPicker=new CurrencyPicker;function CurrencyPicker(){this.selected_currency=null;this.selected_seperator=null}CurrencyPicker.prototype.change=function(event){try{var options=document.getElementById("changeCurrencyFooter").options;var selected=event.target.selectedOptions[0];this.selected_currency=selected.value;this.selected_seperator=selected.getAttribute("data-seperator");for(var key in options){if(typeof options[key]=="object"&&options[key].value!=""){options[key].value!=this.selected_currency?options[key].removeAttribute("selected"):options[key].setAttribute("selected",true)}}this.refreshPage()}catch(e){console.log(e)}};CurrencyPicker.prototype.refreshPage=function(){this.selected_seperator=this.selected_seperator=="."?"dot":this.selected_seperator==","?"comma":this.selected_seperator==" "?"space":this.selected_seperator=="'"?"apos":"";var url=baseUrl+"/currencymanager/default/setcurrency/currency/"+this.selected_currency+"/seperator/"+this.selected_seperator;global&&global.loadinViewAction();$bm("document").get(url,function(){window.location.reload(true)})};CurrencyPicker.prototype.injectOptionDom=function(){try{var lists=JSON.parse(document.getElementById("changeCurrencyFooter").dataset.mblCurrencyOptions);var dropdown=document.getElementById("changeCurrencyFooter");if(dropdown.length==1){for(var key in lists){$bm("#changeCurrencyFooter").injectDOM("#changeCurrencyFooter",lists[key],"append")}}setTimeout((function(){dropdown.click()},100))}catch(e){console.log(e)}};function ScrollEvent(){this.currentScrollPos=0;this.isFooterInViewPort=false}ScrollEvent.prototype.start=function(){$bm("document").addListener("scroll",listeningScrollEvent)};ScrollEvent.prototype.stop=function(){$bm("document").removeListener("scroll",listeningScrollEvent)};ScrollEvent.prototype.scrollTo=function(pos){window.scrollTo(0,pos)};function listeningScrollEvent(e){try{var topSalesInfo=$bm("#topsales");if(!!topSalesInfo){if(window.pageYOffset>0){topSalesInfo.addClass("fixed-position")}else{topSalesInfo.removeClass("fixed-position")}}scroll.currentScrollPos=window.pageYOffset;!scroll.isFooterInViewPort&&$bm("#mbl-footer-right").isInViewport(function(is){scroll.isFooterInViewPort=is;if(scroll.isFooterInViewPort){footer.injectDOM()}});!scroll.isFooterInViewPort&&$bm("#footer").isInViewport(function(is){scroll.isFooterInViewPort=is;if(scroll.isFooterInViewPort){footer.injectDOM()}})}catch(err){console.log(err)}}var scrollEvent=new ScrollEvent;scrollEvent.start();var footer=new Footer;function EmailSubs(){this.email="";this.isSubmitting=false}EmailSubs.prototype.listenInput=function(){try{var self=this;$bm("#subs_email_input").addListener("keyup",function(e){e.preventDefault();self.email=e.target.value;self.isvalidateEmail()?$bm(".f-agree").showDOM():$bm(".f-agree").hideDOM();$bm("#error_sub_msg").hideDOM();$bm("#after_sub_msg").hideDOM()})}catch(e){console.log(e)}};EmailSubs.prototype.isvalidateEmail=function(){var re=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(String(this.email).toLowerCase())};EmailSubs.prototype.isTermsPolicyAccepted=function(){return document.getElementById("footer-signup-check").checked||false};EmailSubs.prototype.submit=function(){try{var url=baseUrl+"/newsletter/ws/emailletter";var request={email:this.email};var isSubmitting=this.isSubmitting;this.isSubmitting=true;!this.isvalidateEmail()&&$bm("#error_sub_msg").showDOM();!isSubmitting&&this.isTermsPolicyAccepted()&&this.isvalidateEmail()?$bm("document").postAjax(url,request,function(res){emailSubs.isSubmitting=false;var response=JSON.parse(res);if(response.status){global.showNotification("green",response.message);$bm("#after_sub_msg").showDOM()}},"application/json;charset=UTF-8"):emailSubs.isSubmitting=false}catch(e){console.log(e)}};var emailSubs=new EmailSubs;function DiscountView(){this.trip_id=null;this.discountAmount=0;this.discountModal=null;this.inProgress=false}DiscountView.prototype.init=function(event){dataDiscount=$bm("[data-discount-save]");dataDiscount.addListener("click",function(event){event.preventDefault();bloader.show();try{discountView.trip_id=event.currentTarget.dataset.discountSave;discountView.discountAmount=event.currentTarget.dataset.discountAmount;!discountView.inProgress&&discountView.openDiscountModal()}catch(e){console.log(e)}})};DiscountView.prototype.openDiscountModal=function(){this.inProgress=true;var self=this;var jsUrl=baseUrl+"/src-js/app/unlockDiscountMbl.js";if(self.discountModal==null&&self.discountAmount){global.loadinViewAction();dataDiscount.getInjectDOM(baseUrl+"/dom/unlockdiscountmbl?m="+global.isMobile,"#data-discount-save-view","replace",function(res){self.discountModal=res;dataDiscount.loadJS(jsUrl,function(){inject();bloader.hide()})})}else if(self.discountModal!=null&&self.discountAmount){global.loadinViewAction();inject();bloader.hide()}function inject(){global.loadinViewAction("remove");self.inProgress=false;$bm("#unlock_discount_modal").addClass("active");var unlockText="Unlock <b>"+self.discountAmount+"</b> in Tour Savings";var selector="#unlock_discount_modal > div > div.locked-preview > div > strong";dataDiscount.injectDOM(selector,unlockText);reInitListenActions()}};var dataDiscount=$bm("[data-discount-save]");var discountView=new DiscountView;discountView.init();var hamburgerMenuButton=$bm("#menu-opener");hamburgerMenuButton.addListener("click",function(event){event.preventDefault();$bm("#wrapper").toggleClass("menu-active")});function loadFBTwitter(){(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id))return;js=d.createElement(s);js.id=id;js.src="connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.8&appId=1581686285431624";fjs.parentNode.insertBefore(js,fjs)})(document,"script","facebook-jssdk");window.twttr=function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src="platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);t._e=[];t.ready=function(f){t._e.push(f)};return t}(document,"script","twitter-wjs")}function customHandler(e){try{if(e.target&&e.target.id=="map_view_close"||e.target.parentElement.id=="map_view_close"){$bm(".map-view").removeClass("active");setTimeout(function(){$bm("#d-mapview").removeClass("active")},500);console.log($bm("#d-mapview"))}}catch(err){console.log(err)}}function universalHandler(e){try{if(e.target&&e.target.id=="mbl-subscribers-submit"){emailSubs.submit()}if(e.target&&(e.target.id=="mbl-noti-close"||e.target.parentElement.id=="mbl-noti-close")){global.hideNotification()}if(e.target&&(e.target.id=="unlock_modal_close_a"||e.target.parentElement.id=="unlock_modal_close_a")){$bm("#unlock_discount_modal").removeClass("active")}if(e.target.className=="w1"){$bm("#wrapper").removeClass("menu-active")}if(typeof e.target.parentNode.parentNode!="undefined"){if(typeof e.target.parentNode.parentNode.dataset.bookingtypeid!="undefined"){var selector="[data-bookingtypeid = '"+e.target.parentNode.parentNode.dataset.bookingtypeid+"']";$bm(selector).toggleClass("hover")}else{$bm(".mbl-tooltip").removeClass("hover")}}!global.isMobile&&closeDropDownOnClickOutside(e)}catch(e){console.log(e)}}function closeDropDownOnClickOutside(e){var parentId=e.target.parentElement?e.target.parentElement.id:null;var id=e.target.id;var parentClass=e.target.parentElement.classList?e.target.parentElement.classList:[];parentClass=[].map.call(parentClass,function(e){return e});var className=e.target.classList?e.target.classList:[];className=[].map.call(className,function(e){return e});if(parentId!="mbl-user-profile-dropwdown-view"&&id!="mbl-user-profile-dropwdown-view"){profileDropView.hide()}if(parentId!="view_recent_tours"&&id!="view_recent_tours"){recentViewTours.recentClass.removeClass("active")}if(parentClass.indexOf("cur")==-1&&className.indexOf("cur")==-1){currencyDropDown.dropDownBtn.removeClass("active")}if((parentClass.indexOf("btn-sort")>-1||className.indexOf("btn-sort")>-1)&&typeof sortTrip!="undefined"){sortTrip.toggleSortOption()}else if(typeof sortTrip!="undefined"){sortTrip.close()}if((parentClass.indexOf("destination-dd")>-1||className.indexOf("destination-dd")>-1)&&(parentClass.indexOf("destination-dropdown-lists")==-1||className.indexOf("destination-dropdown-lists")==-1)&&typeof ddestinationDrop!="undefined"){ddestinationDrop.isdestInjected&&ddestinationDrop.toggleDropdown("dest")}else if(typeof ddestinationDrop!="undefined"&&parentClass.indexOf("destination-dropdown-lists")==-1&&className.indexOf("destination-dropdown-lists")==-1){ddestinationDrop.isdestInjected&&ddestinationDrop.close("dest")}if((parentClass.indexOf("activity-dd")>-1||className.indexOf("activity-dd")>-1)&&(parentClass.indexOf("activity-dropdown-lists")==-1||className.indexOf("activity-dropdown-lists")==-1)&&typeof ddestinationDrop!="undefined"){ddestinationDrop.isactInjected&&ddestinationDrop.toggleDropdown("act")}else if(typeof ddestinationDrop!="undefined"&&parentClass.indexOf("activity-dropdown-lists")==-1&&className.indexOf("activity-dropdown-lists")==-1){ddestinationDrop.isactInjected&&ddestinationDrop.close("act")}if(parentClass.indexOf("top-search")==-1){$bm("#mbl-suggestions-dropdown").hideDOM()}else{if(parentClass.indexOf("top-search")>-1){e.target.value.replace("https://www.bookmundi.com/ /","").length>0?searchFormView.getSuggestions(e.target.value,"bar"):void 0}}}document.addEventListener("change",function(e){if(e.target&&event.target.id=="changeCurrencyFooter"){e.preventDefault();currencyPicker.change(e)}});var imgLazyLoading=function(){function isVisible(el){var top=el.offsetTop;var left=el.offsetLeft;var width=el.offsetWidth;var height=el.offsetHeight;while(el.offsetParent){el=el.offsetParent;top+=el.offsetTop;left+=el.offsetLeft}return top<window.pageYOffset+window.innerHeight&&left<window.pageXOffset+window.innerWidth&&top+height>window.pageYOffset&&left+width>window.pageXOffset}function showVisible(){var forceLazyLoad=typeof arguments[0]=="boolean"?arguments[0]:false;var imageLists=document.querySelectorAll("img");for(var key in imageLists){var img=imageLists[key];var img=imageLists[key];if(img&&!!img.dataset){var realSrc=img.dataset.src;if(!realSrc)continue;var topParent=img.parentElement.parentElement.parentElement;var force=false;var hasLazyForceClass=false;try{hasLazyForceClass=img.classList.contains("force_lazy");force=forceLazyLoad&&hasLazyForceClass}catch(e){throw Error(e)}if(!!topParent&&!force){force=isVisible(topParent)}if(isVisible(img)||force){img.src=realSrc;img.dataset.src="";!!img.dataset.srcset&&img.setAttribute("srcset",img.dataset.srcset)}}}if(Array.from(document.querySelectorAll("[data-src]")).every(function(img){return img.getAttribute("data-src")===""}))window.removeEventListener("scroll",showVisible)}var forceLazyLoad=function(){showVisible(true)};window.addEventListener("scroll",showVisible);showVisible();return{forceLazyLoad:forceLazyLoad}};function CommonFunction(force){return{imageLazyLoading:imgLazyLoading}}var triggerImageLazyLoading=CommonFunction().imageLazyLoading;triggerImageLazyLoading();function MessageCounter(){this.audio=null;this.dom='<span class="msg-count">{{counter}}</span>';this.parentDom=$bm("[data-id=message-counter-parent]").elems[0];try{this.counter=this.parentDom.children.length==2?this.parentDom.children[1].innerText:0}catch(e){this.counter=0}}MessageCounter.prototype.listen=function(){try{if(this.parentDom.children.length!=2){this.counter>0&&this.initialDomInject()}else{this.counter=this.parentDom.children[1].innerText;this.makeMessageBlink()}}catch(e){}};MessageCounter.prototype.initialDomInject=function(){if(this.parentDom.children.length!=2){var newdom=this.dom.replace("{{counter}}",this.counter);$bm("document").injectDOM("[data-id=message-counter-parent]",newdom,"append")}};MessageCounter.prototype.increaseMessageCounter=function(count){try{this.parentDom=$bm("[data-id=message-counter-parent]").elems[0];this.initialDomInject();this.counter=parseInt(this.counter)+parseInt(count);var counterDom=this.parentDom.children[1];if(!!counterDom){counterDom.innerText=this.counter}this.removeCounterDom();this.playSound()}catch(e){}};MessageCounter.prototype.removeCounterDom=function(){this.counter==0&&this.parentDom.children[1].parentNode.removeChild(this.parentDom.children[1])};MessageCounter.prototype.playSound=function(){try{this.audio=this.audio==null?new Audio("https://www.bookmundi.com/files/sounds/newmessage.mp3"):this.audio;this.counter>0?this.audio.play():void 0;this.makeMessageBlink()}catch(e){}};MessageCounter.prototype.makeMessageBlink=function(){this.counter==0?$bm(".msg-top").removeClass("blinking"):$bm(".msg-top").addClass("blinking")};var messageCounter=new MessageCounter;messageCounter.listen();function CurrencyDropdown(){this.dropDownBtn=$bm(".cur")}CurrencyDropdown.prototype.listenHover=function(){$bm("document").addListener("mousemove",onHoverCurrencyPickerAction)};function onHoverCurrencyPickerAction(e){e.preventDefault();$bm("document").removeListener("mousemove",onHoverCurrencyPickerAction);var url=baseUrl+"/dom/currencypicker";$bm("document").getInjectDOM(url,".cur","append",function(){currencyDropDown.listenClick()},true)}CurrencyDropdown.prototype.listenClick=function(){this.dropDownBtn.addListener("click",function(e){e.preventDefault();currencyDropDown.dropDownBtn.toggleClass("active")})};var currencyDropDown=new CurrencyDropdown;!global.isMobile&&currencyDropDown.listenHover();function changeCurrency(curr,seperator){if(seperator=="."){seperator="dot"}if(seperator==","){seperator="comma"}if(seperator==" "){seperator="space"}if(seperator=="'"){seperator="apos"}url=baseUrl+"/currencymanager/default/setcurrency/currency/"+curr+"/seperator/"+seperator;$bm("document").get(url,function(){window.location.reload(true)})}function DesktopLogin(){this.loginBtn=$bm("#desktop-login-button");this.registerBtn=$bm("#desktop-register-button");this.activeView="signin"}DesktopLogin.prototype.init=function(){!!this.loginBtn&&this.loginBtn.addListener("click",function(e){e.preventDefault();desktopLogin.activeView="signin";handleLoginClickEvent()});!!this.registerBtn&&this.registerBtn.addListener("click",function(e){e.preventDefault();desktopLogin.activeView="register";handleLoginClickEvent()})};function handleLoginClickEvent(){$bm("document").loadJS(global.loginJSUrl,function(){injectAction=new InjectAction;injectAction.activeView=desktopLogin.activeView;var lUrl=baseUrl+"/js/app/login.js?v=17";injectAction.initialize(lUrl,function(){!!injectAction.loginFileInjected&&injectAction.showModal()})})}var desktopLogin=new DesktopLogin;desktopLogin.init();function RecentViewTours(){this.recentClass=$bm(".rt");this.btn=$bm("#view_recent_tours");this.domLists=null}RecentViewTours.prototype.listen=function(){this.btn.addListener("click",function(e){e.preventDefault();recentViewTours.recentClass.toggleClass("active");!recentViewTours.domLists&&recentViewTours.injectDom()})};RecentViewTours.prototype.injectDom=function(){var url=global.baseUrl+"/ws/getRecentTrips/";$bm("document").getInjectDOM(url,"#recent-dropdown-list","replace")};var recentViewTours=new RecentViewTours;recentViewTours.listen();if(typeof Storage!=="undefined"){try{if(localStorage.getItem("cookie-hide")==null){$bm(".cookie-bar").showDOM();setTimeout(function(){hideCookie()},1e4)}}catch(e){}}$bm(".btn-cookie").addListener("click",function(event){event.preventDefault();hideCookie()});function hideCookie(){if(typeof Storage!=="undefined"){try{localStorage.setItem("cookie-hide",true)}catch(e){}}$bm(".cookie-bar").hideDOM()};var monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function DomData(){this.product_id=product_id;this.baseUrl=baseUrl;this.provider=provider;this.code=code;this.discountThreshold=discountThreshold;this.symbol=symbol;this.seperator=seperator;this.fromPrice=fromPrice;this.conversionRate=conversionRate;this.isInstant=isInstant;this.bid=bid;this.cdnUrl=cdnUrl;this.agencyLogo=aLogo;this.isDebug=isDebug;this.jsVersion=.35;this.user_id=user_id;this.duration=duration;this.trip_duration_type=trip_duration_type;this.trip_type=trip_type;this.discount_percentage=d_p;this.isMobile=isMobile?1:0;this.login_url=baseUrl+"/user/login?redirect=1";this.popDiscountPopOver=typeof popDiscountPopOver!="undefined"?popDiscountPopOver:null;this.currency=curr;this.isCompanyNameHidden=Boolean(isCompanyNameHidden)||false;this.sepNum=function(num){if(!!num){return num.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+domdata.seperator)}else{return 0}}}var domdata=new DomData;function Notify(){try{var noti=$bm(".noti-top");$bm(".noti-close").addListener("click",function(e){e.preventDefault();noti.fadeOut()});return{show:function(text){$bm("document").injectDOM("#notify-text",text,"replace");noti.fadeIn()},hide:function(){noti.fadeOut()}}}catch(e){}}var notify=new Notify;function BLoader(){try{var loader=document.getElementsByClassName("bloader")[0];return{show:function(){loader.style.display="block"},hide:function(){loader.style.display="none"}}}catch(e){}}var bloader=new BLoader;function Slider(){this.images=document.getElementById("carousel-slider")?document.getElementById("carousel-slider").dataset.sliderImages:null;this.activeImageDom=document.getElementById("slider-active-image");this.slideButton=$bm("[data-slide-button]");this.activeImageIndex=0;this.imageCount=0}Slider.prototype.listen=function(){var self=this;this.images=JSON.parse(this.images);this.imageCount=this.images.length;this.slideButton.addListener("click",function(event){event.preventDefault();var type=event.currentTarget.dataset.slideButton;self.handleImageChangeEvent(type)});this.activeImageDom.addEventListener("mouseenter",imageHoverActions)};Slider.prototype.handleImageChangeEvent=function(type){var self=this;var newIndex=this.activeImageIndex;if(type=="next"){newIndex=newIndex+1;newIndex=newIndex>=this.imageCount?0:newIndex}if(type=="prev"){var newIndex=newIndex-1;newIndex=newIndex<0?this.imageCount-1:newIndex}this.activeImageIndex=newIndex;var newSrc=this.images[this.activeImageIndex];this.toggleImage(newSrc)};Slider.prototype.toggleImage=function(src){var self=this;this.activeImageDom.style.opacity=0;this.activeImageDom.setAttribute("src",src);this.activeImageDom.addEventListener("load",function(e){self.activeImageDom.style.opacity=1})};function imageHoverActions(event){event.preventDefault();slider.imageHoverActions()}Slider.prototype.imageHoverActions=function(){this.activeImageDom.removeEventListener("mouseenter",imageHoverActions);var thumbnailDom=$bm("#slider-thumbnail-images");var liDomLists="";this.images.map(function(image,index){liDomLists+='<li><img src="'+image+'" alt="thumbnails" data-index="'+index+'"/></li>'});thumbnailDom.injectDOM("#slider-thumbnail-images",liDomLists,"replace");this.listenthumbnailImages()};Slider.prototype.listenthumbnailImages=function(){var thumbnails=document.getElementById("slider-thumbnail-images");var children=Array.prototype.slice.call(thumbnails.children);children.forEach(function(child){child.addEventListener("click",function(event){event.preventDefault();slider.activeImageIndex=event.target.dataset.index;var newSrc=slider.images[slider.activeImageIndex];slider.toggleImage(newSrc)})})};var slider=new Slider;slider.images&&slider.listen();var descriptionReadMoreButton=$bm("#link-p");var descriptionContent=$bm(".desc-p");descriptionReadMoreButton.addListener("click",function(event){event.preventDefault();descriptionContent.toggleClass("active");var descText=descriptionContent.hasClass("active")?"View Less":"View More";descriptionReadMoreButton.changeInnerText(descText,false);setTimeout(function(){stickBar.init();bookingSticky.init()},1e3)});function ItineraryAction(){this.itiPulling=false;this.injected=false;this.itiExpandAllButton=$bm("#iti-expand");this.itiTitleLinkLi=$bm(".itinerary>li");this.itiTitleLink=$bm(".itinerary>li>span")}ItineraryAction.prototype.listenItiLinkClicked=function(){var self=this;this.itiTitleLink.addListener("click",function(event){event.preventDefault();this.parentNode.classList.toggle("active");self.injectContent(true)})};ItineraryAction.prototype.expandAllItiClicked=function(){var self=this;this.itiExpandAllButton.addListener("click",function(event){event.preventDefault();var isItiActive=event.currentTarget.dataset.itiActive;var descText="";if(isItiActive=="true"){descText="Expand All";isItiActive="false";self.itiTitleLinkLi.removeClass("active")}else{descText="Collapse All";isItiActive="true";self.itiTitleLinkLi.addClass("active")}self.injectContent(true);self.itiExpandAllButton.setAttribute("data-iti-active",isItiActive);self.itiExpandAllButton.changeInnerText(descText,false)})};ItineraryAction.prototype.injectContent=function(showLoading){this.itiPulling=true;var version_id=null;try{var e=document.getElementById("select-versionlists");version_id=e.options[e.selectedIndex].value.split("?v=")[1]}catch(e){}var self=this;if(!this.injected){bloader.show();var link=domdata.baseUrl+"//dom/GetTripItinerary?id="+domdata.product_id+"&m="+domdata.isMobile;link=version_id?link+"&ver="+version_id:link;self.itiExpandAllButton.get(link,function(res){try{var res=JSON.parse(res);for(var key in res){var id=key;var content=res[key];var dataId="#iti-"+id;$bm(dataId).changeInnerText(content,true)}self.injected=true}catch(e){}bloader.hide();stickBar.init();bookingSticky.init()})}else{stickBar.init();bookingSticky.init()}};var itiAction=new ItineraryAction;itiAction.listenItiLinkClicked();itiAction.expandAllItiClicked();function WhyBookmundiAction(){this.collapsableLists=$bm("#collapse-why-book-collapse");this.collapseButton=$bm(".why-book-more");this.collapseLessButton=$bm(".why-book-less")}WhyBookmundiAction.prototype.collapseClickEvent=function(){var self=this;this.collapseButton.addListener("click",function(event){event.preventDefault();self.collapsableLists.showDOM();self.collapseButton.hideDOM();self.collapseLessButton.showDOM()});this.collapseLessButton.addListener("click",function(event){event.preventDefault();self.collapsableLists.hideDOM();self.collapseButton.showDOM();self.collapseLessButton.hideDOM()})};var whyBookmundi=new WhyBookmundiAction;whyBookmundi.collapseClickEvent();function CreditEarn(){this.earnAmount=0}CreditEarn.prototype.calculate=function(price){var total=price;var localTotal=total;var e=roundNumber(3.5/100*parseFloat(localTotal),0);var limitUSD=350;var localPrice=formatUSDNumberWithoutSep(limitUSD);var lowerLimitUSD=300;var lowerLimitlocalPrice=formatUSDNumberWithoutSep(lowerLimitUSD);if(parseInt(localTotal)<parseInt(lowerLimitlocalPrice)){e=0;this.earnAmount=0;return}else if(parseInt(e)>parseInt(localPrice))e=localPrice;this.earnAmount=e};function formatUSDNumberWithoutSep(num){var conversionRate=domdata.conversionRate;num=roundNumber(conversionRate*num,0);return num}function roundNumber(number,decimals){if(typeof decimals=="undefined"){decimals=0}var d=parseInt(decimals,10),dx=Math.pow(10,d),n=parseFloat(number),f=Math.round(Math.round(n*dx*10)/10)/dx;return f.toFixed(d)}var creditEarn=new CreditEarn;function ApiDepartures(){this.isFbqTriggered=false;this.checkAvailabilityButton=$bm("#check-availability");this.startPrivateTourButton=$bm("#start-private-tour");this.wrapper=$bm("#wrapper");this.selectedDeparture=null;this.isHoldSeatDeparture=false;this.versionLists=[];this.isVersionSelected=null;this.selectedVersionId=null;this.isDepartureInViewPort=false;var datasets=$bm("#select-versionlists").getDataSets();for(var key in datasets){try{this.isVersionSelected=!!datasets[key]?datasets[key].isV:null}catch(e){}}this._renderNow=true;this.groupToursSelectedData=null;this._groupToursClicked=false}ApiDepartures.prototype.listenCheckAvailCommonAction=function(){var self=this;this.checkAvailabilityButton.addListener("click",function(event){event.preventDefault();!domdata.provider&&self.checkAvailabilityButton.addClass("bg-loading");!domdata.provider&&bloader.show();self._departureButtonClick(function(){},true)})};ApiDepartures.prototype.listenViewIsInScroll=function(){$bm("document").addListener("scroll",listeningDepartureScrollEvent)};function listeningDepartureScrollEvent(event){event.preventDefault();if(domdata.provider){if(!apiDepartures.isDepartureInViewPort){apiDepartures.isDepartureInViewPort=true;apiDepartures.initDepartureLists();loadDepartureFiles(function(){if(domdata.provider){apiDepartures.initDepartureLists()}})}}else{!apiDepartures.isDepartureInViewPort&&$bm("#dates-holder").isInViewport(function(is){apiDepartures.isDepartureInViewPort=is;if(is){apiDepartures.initDepartureLists();loadDepartureFiles(function(){if(domdata.provider){apiDepartures.initDepartureLists()}})}})}}ApiDepartures.prototype._departureButtonClick=function(callback,_renderNow){this._renderNow=_renderNow;loadDepartureFiles(function(){!domdata.provider&&callback();!domdata.provider&&apiDepartures.checkAvailabilityButton&&apiDepartures.checkAvailabilityButton.addClass("bg-loading");setTimeout(function(){!domdata.provider&&!apiDepartures._groupToursClicked&&window.scrollTo(1,0)},500)});if(domdata.provider){this.initDepartureLists();this.scrollToView()}else{}};ApiDepartures.prototype.initDepartureLists=function(){var self=this;this.getVersionLists();$bm("document").removeListener("scroll",listeningDepartureScrollEvent)};ApiDepartures.prototype.scrollToView=function(){BMScrollTo.scrollVerticalToElementById("dates-holder",50)};ApiDepartures.prototype.getVersionLists=function(){if(this.versionLists.length==0){try{var versionSelect=document.getElementById("select-versionlists");var versionOptions=!!versionSelect?versionSelect.options:[];var self=this;for(var key in versionOptions){if(!!versionOptions[key].text){var tempVer={name:versionOptions[key].text,link:versionOptions[key].value,id:versionOptions[key].value.split("?v=")[1],selected:versionOptions[key].selected?true:false,version_id:!!versionOptions[key].dataset?versionOptions[key].dataset.rV:null};self.selectedVersionId=tempVer.selected?tempVer.version_id:self.selectedVersionId;console.log(self.selectedVersionId);self.versionLists.push(tempVer)}}}catch(e){console.log(e)}}};ApiDepartures.prototype.setSelectedDeparture=function(departure){this.isHoldSeatDeparture=false;this.selectedDeparture=departure;ApiReactDeparture.openApiReactBookingForm()};ApiDepartures.prototype.holdSeatForSelectedDeparture=function(departure){this.isHoldSeatDeparture=true;this.selectedDeparture=departure;ApiReactDeparture.openApiReactBookingForm()};var apiDepartures=new ApiDepartures;apiDepartures.listenCheckAvailCommonAction();apiDepartures.listenViewIsInScroll();function loadDepartureFiles(callback){var dFile=domdata.provider?"desktop-departures.js":"desktop-nonapi-departures.js";var mblDep=domdata.baseUrl+"/js/app/"+dFile+"?v="+domdata.jsVersion;var doc=$bm("document");var dcss=domdata.baseUrl+"/themes/rupa/resources/css/product/book.css?v="+domdata.jsVersion;loadReactFiles(function(){doc.loadCSS(dcss,function(){doc.loadJS(mblDep,function(){callback()})})})}function loadDatePickerFiles(callback){var datepickerJS="https://cdn.jsdelivr.net/npm/flatpickr";var datepickerCSS="cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.minec92.css?v="+domdata.jsVersion;var doc=$bm("document");doc.loadCSS(datepickerCSS,function(){doc.loadJS(datepickerJS,function(){callback()})})}function loadReactFiles(callback){var doc=$bm("document");if(domdata.isDebug!=1){var reactFile=domdata.baseUrl+"/js/react/react_dom_prod.min.js";doc.loadJS(reactFile,function(){callback()})}else{var reactFile=domdata.baseUrl+"/js/react/react.min.js";var reactDom=domdata.baseUrl+"/js/react/react-dom.min.js";doc.loadJS(reactFile,function(){doc.loadJS(reactDom,function(){callback()})})}}function BookingFormAction(){this.wrapper=$bm("#wrapper");this.productDetails={duration:{type:"",count:0},trip_type:""};this.creditEarn=0}BookingFormAction.prototype.setProductDetails=function(){try{this.productDetails.duration.type=domdata.trip_duration_type;this.productDetails.duration.count=domdata.duration;this.productDetails.trip_type=domdata.trip_type}catch(e){console.log(e)}};BookingFormAction.prototype.setEarnAmount=function(price){creditEarn.calculate(price);this.creditEarn=parseFloat(creditEarn.earnAmount)};var bookingFormAction=new BookingFormAction;bookingFormAction.setProductDetails();bookingFormAction.setEarnAmount(domdata.fromPrice);function MapView(){this.mapButton=$bm("#trip-map-tag");this.locButton=$bm("#trip-loc-tag");this.mapDetails=null;this.mapFileUrl=domdata.baseUrl+"/js/app/desktop-map.js?v="+domdata.jsVersion;this.mapCssUrl=domdata.baseUrl+"/themes/rupa/resources/css/product/map-details.css?v="+domdata.jsVersion;this.activateClass="modal-open"}MapView.prototype.init=function(){var self=this;this.mapButton.addListener("click",function(event){event.preventDefault();bloader.show();self.mapDetails=event.currentTarget.dataset;loadReactFiles(function(){$bm("document").loadCSS(self.mapCssUrl,function(){$bm("document").loadJS(self.mapFileUrl,function(){self.toggleModal()})})})});this.locButton.addListener("click",function(e){e.preventDefault();setTimeout(function(){self.mapButton.click()},500)})};MapView.prototype.toggleModal=function(){$bm("body").toggleClass(this.activateClass);$bm(".map-view").addClass("active");bloader.hide()};var mapViews=new MapView;mapViews.init();function GroupTours(){this.url=domdata.baseUrl+"/products/ws/getnonapibookingformdetails/product_id/"+domdata.product_id;this.priceDataLists=null;this.currentScrollPos=0;this.isGroupTourInViewPort=false;this.domOptions={currentInit:0,limit:5,injectedNum:0,total:0}}GroupTours.prototype.listen=function(){$bm("document").addListener("scroll",listeningGroupToursScrollEvent)};GroupTours.prototype.pullData=function(){var self=this;$bm("document").removeListener("scroll",listeningGroupToursScrollEvent);bloader.show();$bm("document").get(this.url,function(res){self.priceDataLists=JSON.parse(res);self.injectDom();$bm("#loading-group-tours").removeDOM();bloader.hide()})};GroupTours.prototype.injectDom=function(){var lists=this.priceDataLists.groupTourDates;this.domOptions.total=lists.length;var loop=0;for(var i=this.domOptions.currentInit;i<this.domOptions.total;i++){var list=lists[i];var start_date=ReadableDate().get(this.formatDate(list["date"]));var end_date=ReadableDate().get(this.formatDate(list["end_date"]));var confirmed_people=list["confirmed_people"];var ageView=list["confirmed_age"]!=""?'<span class="c-avg">avg age '+list["confirmed_age"]+"</span>":"";var start_city=list["start_city"];var end_city=list["end_city"];var _show=list["visible"];var details=this.getPriceDetails(list["pricing_id"],list["confirmed_people"]);var price=domdata.sepNum(details.price);var symbol=domdata.symbol;var peopleText=list["confirmed_people"]==1?"person":"people";var dom='<div class="av-frame"><ul class="av-list"><li><span>'+start_date+"</span><span>from "+start_city+"</span></li><li><span>"+end_date+"</span><span>to "+end_city+'</span></li><li><span class="g">'+confirmed_people+" "+peopleText+"</span><span>booked</span>"+ageView+'</li><li><span>From </span><span><b class="g">'+symbol+" "+price+'</b>/pers</span></li></ul><a href="javascript:void(0)" class="btn-bd" data-gtours-index="'+i+'">Join Now</a></div>';if(loop==this.domOptions.limit)break;confirmed_people>0&&$bm("document").injectDOM("#group-tours-lists-view",dom,"append");this.domOptions.injectedNum=this.domOptions.injectedNum+1;loop++}setTimeout(function(){stickBar.init();bookingSticky.init()},1500);var viewMoreDom='<div class="av-frame load"><a href="javascript:void(0)" class="v-more" id="loadMoreGroupTours">View more dates</a></div>';try{document.getElementById("loadMoreGroupTours").parentElement.remove()}catch(e){$bm("#loadMoreGroupTours").removeDOM()}this.domOptions.injectedNum<this.domOptions.total&&$bm("document").injectDOM("#group-tours-lists-view",viewMoreDom,"append");this.listenInjectedDom();setTimeout(function(){stickBar.init();bookingSticky.init()},1e3)};GroupTours.prototype.formatDate=function(dateString){var newDate=dateString.replace(/^[,\s]+|[,\s]+$/g,"").replace(/\s*,\s*/g,",").split(",").join("-");return newDate};GroupTours.prototype.listenInjectedDom=function(){var self=this;$bm("#loadMoreGroupTours").addListener("click",function(){self.domOptions.currentInit=self.domOptions.injectedNum;self.injectDom()});$bm("[data-gtours-index]").addListener("click",function(event){event.preventDefault();var selectedIndex=event.currentTarget.dataset.gtoursIndex;var selectedPricing=self.priceDataLists.groupTourDates[selectedIndex];var selected_price=null;for(var i=0;i<self.priceDataLists.prices.length;i++){if(self.priceDataLists.prices[i]["id"]==selectedPricing["pricing_id"]){selected_price=self.priceDataLists.prices[i];break}}if(typeof bookingComponent!="undefined"){bookingComponent.groupTourAction(selectedPricing,selected_price)}else{apiDepartures.groupToursSelectedData={selectedPricing:selectedPricing,selected_price:selected_price};apiDepartures._groupToursClicked=true;apiDepartures.checkAvailabilityButton.click()}})};GroupTours.prototype.getPriceDetails=function(pricing_id,confirmed_people){var price=0;var selectedPrice=null;for(var i=0;i<this.priceDataLists.prices.length;i++){if(this.priceDataLists.prices[i].id==pricing_id){selectedPrice=this.priceDataLists.prices[i];price=this.priceDataLists.prices[i].adult_price;var scaled_price=this.priceDataLists.prices[i].scaled_price;if(scaled_price.length>0){var confirmedNewNum=parseInt(confirmed_people)+1;scaled_price.map(function(scaled){if(scaled.low_no_people>0&&scaled.high_no_people>0){if(confirmedNewNum>=scaled.low_no_people&&confirmedNewNum<=scaled.high_no_people){price=scaled.retail_rate_person}}else if(scaled.low_no_people>0&&!scaled.high_no_people){if(confirmedNewNum>=scaled.low_no_people){price=scaled.retail_rate_person}}})}}}return{price:price}};function listeningGroupToursScrollEvent(){try{groupTours.currentScrollPos=window.pageYOffset;!groupTours.isGroupTourInViewPort&&$bm("#group-tours-lists").isInViewport(function(is){groupTours.isGroupTourInViewPort=is;if(groupTours.isGroupTourInViewPort){groupTours.pullData()}})}catch(err){console.log(err)}}var groupTours=new GroupTours;groupTours.listen();function ReadableDate(){return{get:function(date){var input=date.split(" ")[0];var splitDate,mth,yr,dat;splitDate=input.split("-");yr=splitDate[0];dat=splitDate[2];var d=new Date(input);mth=monthNames[d.getMonth()];d=dat+" "+mth+" "+yr;return d}}}function ChatDuplex(){this.duplexDetails=null;this.makeInquiryButton=$bm("#make-enquiry");this.duplexDom=$bm("#chat-duplex-lite-dom");this.connectionUrl=domdata.baseUrl+"/duplex/duplexlite/makeconnection";this.agencyName=null;this.tripTitle=null;this.isAgencyNameHidden=null;this.connectionPostData={agency_id:null}}ChatDuplex.prototype.listen=function(){var self=this;this.makeInquiryButton.addListener("click",function(event){event.preventDefault();self.makeInquiryButton.addClass("bg-loading-b");bloader.show();self.connectionPostData.agency_id=event.currentTarget.dataset.duplexAgencyId;self.agencyName=event.currentTarget.dataset.duplexAgencyName;self.tripTitle=event.currentTarget.dataset.duplexMblTitle;self.isAgencyNameHidden=event.currentTarget.dataset.duplexAnameHidden;self.loadDuplexFiles(function(){duplexComponent.init()})})};ChatDuplex.prototype.loadDuplexFiles=function(callback){loadDatePickerFiles(function(){var mblDep=domdata.isMobile?domdata.baseUrl+"/js/app/mbl-duplex.js?v="+domdata.jsVersion:domdata.baseUrl+"/js/app/desktop-duplex.js?v="+domdata.jsVersion;var duplexCss=domdata.isMobile?domdata.baseUrl+"/themes/rara/resources/css/product/enquiry.css?v="+domdata.jsVersion:domdata.baseUrl+"/themes/rupa/resources/css/product/enquiry.css?v="+domdata.jsVersion;var doc=$bm("document");pullPusherJs(function(){doc.loadCSS(duplexCss,function(){loadReactFiles(function(){doc.loadJS(mblDep,function(){pullSimpleBarJs(function(){callback()})})})})})})};ChatDuplex.prototype.openDuplexModal=function(){messageCounter.counter=0;messageCounter.increaseMessageCounter(0);this.toggleModal()};ChatDuplex.prototype.toggleModal=function(){$bm("#duplex_view_slide").toggleClass("active")};var chatDuplex=new ChatDuplex;chatDuplex.listen();function pullSimpleBarJs(callback){var doc=$bm("document");var simplebarJs="unpkg.com/simplebar%404.2.3/dist/simplebar.min.js";var simplebarCss=domdata.baseUrl+"/themes/rupa/resources/css/common/simple-scroll.css?v=2.8";doc.loadCSS(simplebarCss,function(){doc.loadJS(simplebarJs,function(){callback()})})}function PusherAction(){this.url=domdata.baseUrl+"/themes/rara/resources/js/product/critical/lazy-scripts.js";this.injected=false}PusherAction.prototype.pull=function(){var doc=$bm("document");doc.addListener("touchmove",function(event){event.preventDefault();var isInjected=pushAction.injected;pushAction.injected=true;!isInjected&&pullPusherJs(function(){})})};function pullPusherJs(callback){var doc=$bm("document");doc.loadJS(pushAction.url,function(){callback()})}var pushAction=new PusherAction;pushAction.pull();function ReviewAction(){this.loadMore=$bm("[data-loadcompanyreviews]");this.productLoadMoreButton=$bm("#loadMoreProductReviews");this.agency_id=null;this.productReview={page:1,total_count:0}}ReviewAction.prototype.listen=function(){var self=this;this.loadMore.addListener("click",function(event){event.preventDefault();try{self.agency_id=event.currentTarget.dataset.agId;self.afterTiggerClickAction()}catch(e){console.log(e)}});this.productLoadMoreButton.addListener("click",function(event){event.preventDefault();self.productReview.total_count=event.currentTarget.dataset.totalReviewCount;self.handleProductReviewLoad()});$bm("#scroll-to-reviews").addListener("click",function(event){event.preventDefault();BMScrollTo.scrollVerticalToElementById("product-reviews",50)});$bm("#tour-stars").addListener("click",function(event){event.preventDefault();BMScrollTo.scrollVerticalToElementById("product-reviews",50)});$bm("#tour-stars-r").addListener("click",function(event){event.preventDefault();BMScrollTo.scrollVerticalToElementById("product-reviews",50)})};ReviewAction.prototype.afterTiggerClickAction=function(){bloader.show();var self=this;var mblReview=domdata.baseUrl+"/js/app/mbl-review.js?v="+domdata.jsVersion;var duplexCss=domdata.baseUrl+"/themes/rupa/resources/css/product/enquiry.css?v="+domdata.jsVersion;loadReactFiles(function(){pullSimpleBarJs(function(){$bm("document").loadCSS(duplexCss,function(){$bm("document").loadJS(mblReview,function(){typeof reviewComponent!="undefined"?self.openModal():void 0})})})})};ReviewAction.prototype.openModal=function(){$bm("#mbl-review-lists > div").addClass("active");bloader.hide()};ReviewAction.prototype.closeModal=function(){$bm("#mbl-review-lists > div").removeClass("active")};ReviewAction.prototype.handleProductReviewLoad=function(){var self=this;var url=domdata.baseUrl+"/products/default/reviews/page/"+self.productReview.page+"/agencyid/"+domdata.product_id+"/mbl/1";$bm("document").getInjectDOM(url,"#mblReviewList","append",function(){self.productReview.page=self.productReview.page+1;if(self.productReview.page*4>=self.productReview.total_count){$bm("#loadMoreProductReviewsParent").hideDOM()}setTimeout(function(){stickBar.init();bookingSticky.init()},500)})};var reviewAction=new ReviewAction;reviewAction.listen();function TripNoteDownload(){this.url=domdata.baseUrl+"/api/default/getpdflive/";this.cssUrl=domdata.baseUrl+"/themes/rupa/resources/css/product/trip-notes.css?v="+domdata.jsVersion;this.request={code:domdata.code,email:null,provider:domdata.provider,view:false,version_id:null};this.downloadButton=$bm('[data-id="trip-note-btn"]');this.modalView=$bm("#trip_notes_modal");this.modalViewDom=document.getElementById("trip_notes_modal")||{style:{display:""}};this.closeModalButton=$bm("#unlock_modal_close_a");this.submitButton=$bm("#submit-trip-note");this.seeLowerBtn=$bm("#see-lower");this.inputForm={email:null,acceptTerms:null};this.response=null}TripNoteDownload.prototype.listen=function(){this.modalViewDom.style.display="none";var self=this;this.downloadButton.addListener("click",function(event){event.preventDefault();self.request.version_id=event.currentTarget.dataset.ver;self._pullCss(function(){setTimeout(function(){self.openModal()},500)})});this.closeModalButton.addListener("click",function(event){event.preventDefault();self.modalViewDom.style.display="none";self.toggleModal()});this.submitButton.addListener("click",function(event){event.preventDefault();self.validateForm()&&self.sendRequest()});this.seeLowerBtn.addListener("click",function(event){event.preventDefault();self.modalViewDom.style.display="none";self.toggleModal()})};TripNoteDownload.prototype.openModal=function(){this.modalViewDom.style.display="block";this.initForm();this.toggleModal()};TripNoteDownload.prototype.toggleModal=function(){this.modalView.toggleClass("active")};TripNoteDownload.prototype.initForm=function(){try{this.inputForm.email=document.getElementById("unlock_email");this.inputForm.acceptTerms=document.getElementById("unlock-signup-check");this.setInputs("email","");this.setInputs("acceptTerms",true);this.response=null;this.modalView.removeClass("done");document.getElementById("tripnote-email-err").style.display="none"}catch(e){console.log(e)}};TripNoteDownload.prototype.setInputs=function(key,value){if(key=="email"){this.inputForm.email.value=value}if(key=="acceptTerms"){this.inputForm.acceptTerms.checked=value}};TripNoteDownload.prototype.validateForm=function(){var re=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;var isEmailValid=re.test(String(this.inputForm.email.value).toLowerCase());var isAccepted=this.inputForm.acceptTerms.checked==true;document.getElementById("tripnote-email-err").style.display=isEmailValid?"none":"block";return isEmailValid&&isAccepted};TripNoteDownload.prototype.sendRequest=function(){var self=this;this.request.email=this.inputForm.email.value;this.submitButton.addClass("bg-loading");$bm("document").postAjax(this.url,this.request,function(res){try{self.response=JSON.parse(res);self.formSubmitted()}catch(e){console.log(e)}},"application/json;charset=UTF-8")};TripNoteDownload.prototype.formSubmitted=function(){try{this.modalView.addClass("done");$bm("#trip-note-discount-code").changeInnerText(this.response.token);$bm("#trip-note-offer-text").changeInnerText(this.response.discount+"% SPECIAL DISCOUNT OFFER");$bm("#d-t-text").changeInnerText(this.response.discount+"% discount");$bm("#trip-note-email").changeInnerText(this.inputForm.email.value);this.submitButton.removeClass("bg-loading")}catch(e){console.log(e)}};TripNoteDownload.prototype._pullCss=function(callback){$bm("document").loadCSS(this.cssUrl,function(){callback()})};function download(filename,uri){downloadLink=document.createElement("a");downloadLink.download=filename;downloadLink.href=uri;downloadLink.style.display="none";document.body.appendChild(downloadLink);downloadLink.click()}var tripNoteDownload=new TripNoteDownload;tripNoteDownload.listen();function TripNotesDetails(){this.tripNotePulling=false;this.injected=false;this.notesExpandAllButton=$bm("#notes-expand");this.noteLink=$bm("[data-trip-notes-id]")}TripNotesDetails.prototype.listenItiLinkClicked=function(){var self=this;this.noteLink.addListener("click",function(event){event.preventDefault();this.classList.toggle("active");self.injectContent(true)})};TripNotesDetails.prototype.expandAllItiClicked=function(){var self=this;this.notesExpandAllButton.addListener("click",function(event){event.preventDefault();var isItiActive=event.currentTarget.dataset.tripnotesActive;var descText="";if(isItiActive=="true"){descText="Expand All";isItiActive="false";self.noteLink.removeClass("active")}else{descText="Collapse All";isItiActive="true";self.noteLink.addClass("active")}self.injectContent(true);self.notesExpandAllButton.setAttribute("data-tripnotes-active",isItiActive);self.notesExpandAllButton.changeInnerText(descText,false);setTimeout(function(){stickBar.init();bookingSticky.init()},500)})};TripNotesDetails.prototype.injectContent=function(showLoading){var self=this;this.tripNotePulling=true;if(!this.injected){bloader.show();var link=domdata.baseUrl+"//dom/GetTripNotesDetails?id="+domdata.product_id;self.notesExpandAllButton.get(link,function(res){try{var res=JSON.parse(res);for(var key in res){var id=key;var content=res[key];var dataId="#trip-notes-"+id;$bm(dataId).changeInnerText(content,true)}bloader.hide();self.injected=true}catch(e){console.log(e)}})}};var tripNotesDetails=new TripNotesDetails;tripNotesDetails.listenItiLinkClicked();tripNotesDetails.expandAllItiClicked();function StickyBarAction(){this.stikyNav=$bm("#stiky-top")}StickyBarAction.prototype.init=function(){this.listen();this.selectStickyOptions();this.stickyOptionScroll()};StickyBarAction.prototype.listen=function(){var self=this;$bm("document").addListener("scroll",function(e){window.scrollY>200?self.stikyNav.addClass("active"):self.stikyNav.removeClass("active")})};StickyBarAction.prototype.selectStickyOptions=function(){try{var scrl=document.querySelectorAll(".scrl");var sections={};Array.prototype.forEach.call(scrl,function(e){sections[e.id]=e.offsetTop});$bm("document").addListener("scroll",function(e){var scrollPosition=(document.documentElement.scrollTop||document.body.scrollTop)+150;for(var key in sections){var isT=sections[key]<=scrollPosition;isT&&$bm(".scrl-active").removeClass(null);isT&&$bm("a[href*="+key+"]").addClass("scrl-active")}})}catch(e){console.log(e)}};StickyBarAction.prototype.stickyOptionScroll=function(){var scrlSelectors=$bm(".s-nav a");scrlSelectors.addListener("click",function(e){e.preventDefault();BMScrollTo.scrollVerticalToElementById(e.target.hash.replace("#",""),50)})};var stickBar=new StickyBarAction;stickBar.init();function TripPlannerAction(){this.closeBtn=$bm(".p-cross");this.needExpertBtn=$bm(".p-t-btn");this.timer=1e4;this.advisorTimer=5e3;this.isnotAlreadyShown=localStorage.getItem("plannerSeen")===null&&typeof Storage!=="undefined";var self=this;this.closeBtn.addListener("click",function(e){e.preventDefault();self.togglePlannerTemplate("remove")});this.needExpertBtn.addListener("click",function(e){e.preventDefault();self.isnotAlreadyShown=true;self.timer=0;self.togglePlannerTemplate("add")})}TripPlannerAction.prototype.togglePlannerTemplate=function(type){var self=this;type=="add"&&this.isnotAlreadyShown&&setTimeout(function(){$bm("#p-slide").toggleClass("active");self.toggleAdvisorTemplate("remove")},self.timer);if(type=="remove"){localStorage.setItem("plannerSeen",1);$bm("#p-slide").removeClass("active");self.isnotAlreadyShown=false;self.advisorTimer=0;self.toggleAdvisorTemplate("add")}if(type=="add"){var plannerImgTag=document.getElementById("planner_helper_image");if(!!plannerImgTag){var plannerImgTagInner=plannerImgTag.innerHTML;plannerImgTagInner=plannerImgTagInner.trim?plannerImgTagInner.trim():plannerImgTagInner.replace(/^\s+/,"");var pImage='<img alt="Jane Andersen, Customer Service" src="themes/global/resources/images/jane1.png">';plannerImgTagInner==""&&$bm("document").injectDOM("#planner_helper_image",pImage,"replace")}}};TripPlannerAction.prototype.toggleAdvisorTemplate=function(type){var self=this;type=="add"&&!this.isnotAlreadyShown&&setTimeout(function(){$bm(".p-t-btn").addClass("active")},self.advisorTimer);type=="remove"&&$bm(".p-t-btn").removeClass("active")};var tripPlannerAction=new TripPlannerAction;tripPlannerAction.togglePlannerTemplate("add");tripPlannerAction.toggleAdvisorTemplate("add");$bm(".gd-link").addListener("click",function(e){e.preventDefault();var dom=document.getElementById("gd-discount");if(!!dom){var display=dom.style.display;dom.style.display=display=="block"?"none":"block"}});function ShipAction(){this.wrapper=$bm("#ship-holder-modal");this.shipButton=$bm("[data-ship-id]");this.ship_id=null;this.shipDetails=[]}ShipAction.prototype.listenShipButtonClick=function(){var self=this;this.shipButton.addListener("click",function(event){event.preventDefault();try{self.ship_id=!!event.target.dataset.shipId?parseInt(event.target.dataset.shipId):null;self.ship_id&&self.pullShipDetails()}catch(e){console.log("ship error",e)}})};ShipAction.prototype.pullShipDetails=function(){var self=this;var isShipDetailsAlreadyAvailable=this.shipDetails[this.ship_id];if(!!isShipDetailsAlreadyAvailable){this.openShipModal();this.injectShipContent()}else{bloader.show();this.pullFromServer(function(response){bloader.hide();self.setShipDetails(response);self.openShipModal();self.injectShipContent()})}};ShipAction.prototype.setShipDetails=function(details){this.shipDetails[this.ship_id]=details};ShipAction.prototype.pullFromServer=function(callback){var self=this;this.injectShipJs(function(){self.injectShipCss(function(){var url=domdata.baseUrl+"/ships/ws/getshipdetails";$bm("document").postAjax(url,self.ship_id,function(res){var response=JSON.parse(res);callback(response)},"application/json;charset=UTF-8")})})};ShipAction.prototype.injectShipCss=function(callback){var shipCss=domdata.baseUrl+"/themes/rupa/resources/css/product/components/ships.css?v="+domdata.jsVersion;$bm("document").loadCSS(shipCss,function(){callback()})};ShipAction.prototype.injectShipJs=function(callback){var shipCss=domdata.baseUrl+"/js/app/desktop-ship.js?v="+domdata.jsVersion;loadReactFiles(function(){$bm("document").loadJS(shipCss,function(){callback()})})};ShipAction.prototype.openShipModal=function(){$bm("body").addClass("modal-open");this.wrapper.addClass("active")};ShipAction.prototype.closeShipModal=function(){this.wrapper.removeClass("active");$bm("body").removeClass("modal-open")};ShipAction.prototype.injectShipContent=function(){var shipDetails=this.shipDetails[this.ship_id];ShipModalComponent.setShipDetails(shipDetails)};var shipAction=new ShipAction;shipAction.listenShipButtonClick();function BookingFormSticky(){this.stikyBox=document.querySelector(".stiky-box");this.stikyBoxHeight=this.stikyBox.offsetHeight;this.stikyBoxOffset=offset(this.stikyBox).top;this.sideBoxHeight=document.getElementById("sbox-wrap").offsetHeight;this.sideBoxTotalHeight=this.stikyBoxOffset+this.sideBoxHeight}BookingFormSticky.prototype.init=function(){this.stikyBox=document.querySelector(".stiky-box");this.sideBarHeight=document.getElementById("sidebar").offsetHeight;this.mainBarHeight=document.querySelector(".p-holder").offsetHeight};BookingFormSticky.prototype.listenScroll=function(){var self=this;$bm("document").addListener("scroll",function(e){self.stickyClass()})};BookingFormSticky.prototype.stickyClass=function(){window.pageYOffset>this.sideBoxTotalHeight&&window.pageYOffset<this.mainBarHeight-this.stikyBoxHeight?this.stikyBox.classList.add("active"):this.stikyBox.classList.remove("active")};var bookingSticky=new BookingFormSticky;bookingSticky.init();bookingSticky.listenScroll();function offset(el){if(el){var rect=el.getBoundingClientRect(),scrollLeft=window.pageXOffset||document.documentElement.scrollLeft,scrollTop=window.pageYOffset||document.documentElement.scrollTop;return{top:rect.top+scrollTop,left:rect.left+scrollLeft}}}function ChartView(){this.isDraw=false;this.filterDateLists=[];this.chartDepartureLists=[]}ChartView.prototype.initVariables=function(){this.priceslists=[];this.monthLists=[];this.windowSize=window.innerWidth||document.documentElement.clientWidth||document.getElementsByTagName("body")[0].clientWidth;this.graphContainer=document.getElementById("graph-container");this.newchart=new ChartClass;this.isDraw=true;return this};ChartView.prototype.getchartDepartureLists=function(callback,filters){var self=this;var url=domdata.baseUrl+"/api/default/chartdepartures/";var requests={provider:domdata.provider,code:domdata.code,filters:filters};$bm("document").postAjax(url,requests,function(res){try{self.chartDepartureLists=JSON.parse(res);document.getElementById("departure-graph").style.display="block";self.chartDepartureLists.length>1?callback():self.removeChartView()}catch(e){console.log(e)}},"application/json;charset=UTF-8")};ChartView.prototype.removeChartView=function(){$bm("#departure-graph").removeDOM()};ChartView.prototype.draw=function(){chartView.manipulateChartData(function(){chartView.initChartClass()})};ChartView.prototype.init=function(callback){try{var self=this;this.ctx=document.getElementById("myChart").getContext("2d");this.pullFiles(function(){callback()})}catch(e){}};ChartView.prototype.pullFiles=function(callback){var cssFiles=domdata.baseUrl+"/themes/rupa/resources/css/product/components/chart-styles.css?v="+domdata.jsVersion;var jsFiles=domdata.baseUrl+"/js/angular/angular-chart/chart.min.js";pullSimpleBarJs(function(){$bm("document").loadCSS(cssFiles,function(){$bm("document").loadJS(jsFiles,function(){callback()})})})};ChartView.prototype.manipulateChartData=function(callback){var monthWiseGroup=[];this.chartDepartureLists.map(function(m){var mthSplitlists=m["sd"].split("-");if(mthSplitlists[0]){var matchMth=mthSplitlists[0]+"-"+mthSplitlists[1];if(typeof monthWiseGroup[matchMth]!="undefined"){if(m.dp<monthWiseGroup[matchMth]){monthWiseGroup[matchMth]=m.dp}}else{monthWiseGroup[matchMth]=m.dp}}});for(var key in monthWiseGroup){this.priceslists.push(monthWiseGroup[key]);var cmth=this.getCustomYearMonthName(key);if(chartView.filterDateLists.indexOf(cmth)>=0){this.monthLists.push(cmth)}}var chartWidth=this.windowSize>1199?720:this.windowSize>979?586:this.windowSize>767?475:345;var n=this.windowSize>1199?9:this.windowSize>979?7:this.windowSize>767?5:3;if(this.monthLists.length>n){chartWidth=80*this.monthLists.length}chartView.graphContainer.style.width=chartWidth+"px";callback()};ChartView.prototype.getCustomYearMonthName=function(dte){var split=dte.split("-");var year=split[0];var monthName=monthNames[+dte.split("-")[1]-1];return monthName+" "+year};ChartView.prototype.initChartClass=function(){this.newchart.chartLabels=this.monthLists;this.newchart.chartData=this.priceslists;this.newchart.chartLabelText=domdata.currency;this.newchart.initilize()};var chartView=new ChartView;function ChartClass(){this.chartType="line";this.chartLabelText="test";this.chartLabels=monthNames;this.chartData="testData";this.chartStyles={backgroundColor:"#dff0da",borderColor:"rgba(0,0,0,0.2)",borderWidth:.35};this.chartOptions={title:{display:false},legend:{display:false},scales:{onHover:function(e){e.target.style.cursor="pointer"},yAxes:[{stacked:true,display:false}],xAxes:[{gridLines:{display:false},options:{events:["click"]},ticks:{fontColor:"#3eb368"}}]},responsive:true,maintainAspectRatio:false,layout:{padding:{left:40,right:40,top:25,bottom:0}},showAllTooltips:true,scaleShowLabels:false,tooltips:{enabled:true,displayColors:false,backgroundColor:"rgba(0,0,0,0)",bodyFontColor:"#3eb368",bodyFontStyle:"bold",bodyFontFamily:"'Roboto', Arial, 'Helvetica Neue', Helvetica, sans-serif",yAlign:"bottom",xAlign:"center",callbacks:{label:function(tooltipItem,data){return domdata.currency+" "+domdata.sepNum(tooltipItem.yLabel)},title:function(tooltipItem,data){return}}},onClick:function(e){var xLabel=this.scales["x-axis-0"].getValueForPixel(e.offsetX);var selectedMonth=chartView.monthLists[xLabel];apiDepartures.scrollToView();ApiReactDeparture.filterChange("filter",selectedMonth)}}}ChartClass.prototype.initilize=function(){chartTooltip();var myChart=new Chart(chartView.ctx,{type:this.chartType,data:{labels:this.chartLabels,datasets:[{label:this.chartLabelText,data:this.chartData,backgroundColor:this.chartStyles["backgroundColor"],borderColor:this.chartStyles["borderColor"],borderWidth:this.chartStyles["borderWidth"],pointBackgroundColor:"#3eb368",pointStyle:this.chartStyles["pointStyle"],pointRadius:3}]},options:this.chartOptions});setTimeout(function(){stickBar.init();bookingSticky.init()},1e3)};function chartTooltip(){Chart.pluginService.register({beforeInit:function(chart){var hasWrappedTicks=chart.config.data.labels.some(function(label){return label.indexOf("\n")!==-1});if(hasWrappedTicks){var tickFontSize=Chart.helpers.getValueOrDefault(chart.options.scales.xAxes[0].ticks.fontSize,Chart.defaults.global.defaultFontSize);var maxLines=chart.config.data.labels.reduce(function(maxLines,label){return Math.max(maxLines,label.split("\n").length)},0);var height=(tickFontSize+2)*maxLines+(chart.options.scales.xAxes[0].ticks.padding||0);Chart.layoutService.addBox(chart,{draw:Chart.helpers.noop,isHorizontal:function(){return true},update:function(){return{height:this.height}},height:height,options:{position:"bottom",fullWidth:1}});chart.options=Chart.helpers.configMerge(chart.options,{scales:{xAxes:[{ticks:{display:false,fontSize:0}}]}});chart.hasWrappedTicks={tickFontSize:tickFontSize}}},afterDraw:function(chart){if(chart.hasWrappedTicks){chart.chart.ctx.save();var tickFontSize=chart.hasWrappedTicks.tickFontSize;var tickFontStyle=Chart.helpers.getValueOrDefault(chart.options.scales.xAxes[0].ticks.fontStyle,Chart.defaults.global.defaultFontStyle);var tickFontFamily=Chart.helpers.getValueOrDefault(chart.options.scales.xAxes[0].ticks.fontFamily,Chart.defaults.global.defaultFontFamily);var tickLabelFont=Chart.helpers.fontString(tickFontSize,tickFontStyle,tickFontFamily);chart.chart.ctx.font=tickLabelFont;chart.chart.ctx.textAlign="center";var tickFontColor=Chart.helpers.getValueOrDefault(chart.options.scales.xAxes[0].fontColor,Chart.defaults.global.defaultFontColor);chart.chart.ctx.fillStyle=tickFontColor;var meta=chart.getDatasetMeta(0);var xScale=chart.scales[meta.xAxisID];var yScale=chart.scales[meta.yAxisID];chart.config.data.labels.forEach(function(label,i){label.split("\n").forEach(function(line,j){chart.chart.ctx.fillText(line,xScale.getPixelForTick(i+.5),(chart.options.scales.xAxes[0].ticks.padding||0)+yScale.getPixelForValue(yScale.min)+j*(chart.hasWrappedTicks.tickFontSize+2))})});chart.chart.ctx.restore()}}});Chart.pluginService.register({beforeRender:function(chart){if(chart.config.options.showAllTooltips){chart.pluginTooltips=[];chart.config.data.datasets.forEach(function(dataset,i){chart.getDatasetMeta(i).data.forEach(function(sector,j){chart.pluginTooltips.push(new Chart.Tooltip({_chart:chart.chart,_chartInstance:chart,_data:chart.data,_options:chart.options.tooltips,_active:[sector]},chart))})});chart.options.tooltips.enabled=false}},afterDraw:function(chart,easing){if(chart.config.options.showAllTooltips){if(!chart.allTooltipsOnce){if(easing!==1)return;chart.allTooltipsOnce=true}chart.options.tooltips.enabled=true;Chart.helpers.each(chart.pluginTooltips,function(tooltip){tooltip.initialize();tooltip.update();tooltip.pivot();tooltip.transition(easing).draw()});chart.options.tooltips.enabled=false}}})}(function(){$bm("document").addListener("click",function(e){try{var path=e.path;var idLists=path.map(function(p){return p.id});var classLists=path.map(function(p){return p.className});var isCalendarClicked=classLists.map(function(className){return typeof className=="string"?className.indexOf("flatpickr")>-1:false}).indexOf(true)>-1;if(idLists.indexOf("duplex_view_slide")==-1&&!isCalendarClicked){$bm("#duplex_view_slide").hasClass("active")&&$bm("#duplex_view_slide").removeClass("active")}if(idLists.indexOf("mbl-review-lists")==-1){var rD=$bm("#mbl-review-lists > div");!e.target.dataset.hasOwnProperty("loadcompanyreviews")&&rD.hasClass("active")&&rD.removeClass("active")}if(!!e.target.offsetParent&&savingToolTipAction().id==e.target.offsetParent.id){e.target.offsetParent.className=="pop-active"?savingToolTipAction().close():savingToolTipAction().show()}else{savingToolTipAction().close()}}catch(e){}})})();var savingToolTipAction=function(){var id="booking_saving_text";var close=function(){$bm("#"+id).removeClass("pop-active")};var show=function(){$bm("#"+id).addClass("pop-active")};return{id:id,close:close,show:show}};savingToolTipAction();function ReviewsIo(){this.slideButton=$bm("[data-slide-review-button]");this.selectedIndex=0;this.totalReviewCount=0}ReviewsIo.prototype.init=function(){try{var carousel=document.getElementsByClassName("rio-carousel")[0];this.totalReviewCount=carousel.getAttribute("data-c")}catch(e){console.log(e)}};ReviewsIo.prototype.slide=function(){var self=this;this.slideButton.addListener("click",function(e){e.preventDefault();self.handleReviewChangeEvent(e.currentTarget.dataset.slideReviewButton);self.toggleReview()})};ReviewsIo.prototype.handleReviewChangeEvent=function(type){try{var self=this;var newIndex=this.selectedIndex;if(type=="next"){newIndex=newIndex+1;newIndex=newIndex>=this.totalReviewCount?0:newIndex}if(type=="prev"){var newIndex=newIndex-1;newIndex=newIndex<0?this.totalReviewCount-1:newIndex}this.selectedIndex=newIndex}catch(e){}};ReviewsIo.prototype.toggleReview=function(){try{var dataId="[data-id=rio-item-"+this.selectedIndex+"]";$bm(".rio-item ").removeClass("active");$bm(dataId).addClass("active");this.handleReadButton()}catch(e){}};ReviewsIo.prototype.handleReadButton=function(){try{var moreDataId="review-io-comment-long-"+this.selectedIndex;var lessDataId="review-io-comment-short-"+this.selectedIndex;var readMoreDom=$bm("[data-id="+moreDataId+"]");var readLessDom=$bm("[data-id="+lessDataId+"]");readLessDom.showDOM();readMoreDom.hideDOM();$bm(".r-link").addListener("click",function(e){e.preventDefault();var parentDataSetId=e.currentTarget.parentElement.dataset.id;if(parentDataSetId==moreDataId){readLessDom.showDOM();readMoreDom.hideDOM()}if(parentDataSetId==lessDataId){readLessDom.hideDOM();readMoreDom.showDOM()}})}catch(e){}};var reviewIo=new ReviewsIo;reviewIo.init();reviewIo.slide();reviewIo.handleReadButton();function r(f){/in/.test(document.readyState)?setTimeout("r("+f+")",9):f()}r(function(){if(!document.getElementsByClassName){var getElementsByClassName=function(node,classname){var a=[];var re=new RegExp("(^| )"+classname+"( |$)");var els=node.getElementsByTagName("*");for(var i=0,j=els.length;i<j;i++)if(re.test(els[i].className))a.push(els[i]);return a};var videos=getElementsByClassName(document.body,"youtube")}else{var videos=document.getElementsByClassName("youtube")}var nb_videos=videos.length;for(var i=0;i<nb_videos;i++){videos[i].style.backgroundImage="url(https://i.ytimg.com/vi/"+videos[i].id+"/sddefault.jpg)";var play=document.createElement("div");play.setAttribute("class","play");videos[i].appendChild(play);videos[i].onclick=function(){var iframe=document.createElement("iframe");var iframe_url="https://www.youtube.com/embed/"+this.id+"?autoplay=1&autohide=1";if(this.getAttribute("data-params"))iframe_url+="&"+this.getAttribute("data-params");iframe.setAttribute("src",iframe_url);iframe.setAttribute("frameborder","0");iframe.style.width=this.style.width;iframe.style.height=this.style.height;this.parentNode.replaceChild(iframe,this)}}});function RelatedSeo(){this.isInViewPort=false;var link=domdata.baseUrl+"/products/default/GetProductSeoDom/id/"+domdata.product_id;this.pullAndInject=function(){this.isInViewPort=true;$bm("document").removeListener("scroll",listeningSeoLinksScrollEvent);$bm("document").get(link,function(res){inject(res)})};var inject=function(domData){var data=JSON.parse(domData);$bm("document").injectDOM("#related_trip_dom",data.relatedTrips,"replace");$bm("document").injectDOM("#seo_links_dom",data.seoLinks,"replace")};return{isInViewPort:isInViewPort,pullAndInject:pullAndInject}}$bm("document").addListener("scroll",listeningSeoLinksScrollEvent);function listeningSeoLinksScrollEvent(){var hasSeoDom=document.getElementById("related_trip_dom");if(!!hasSeoDom){$bm(".press-logos").isInViewport(function(is){is&&!RelatedSeo().isInViewPort&&RelatedSeo().pullAndInject()});$bm("#includes").isInViewport(function(is){is&&!RelatedSeo().isInViewPort&&RelatedSeo().pullAndInject()});$bm("#related_trip_dom").isInViewport(function(is){is&&!RelatedSeo().isInViewPort&&RelatedSeo().pullAndInject()});$bm("#seo_links_dom").isInViewport(function(is){is&&!RelatedSeo().isInViewPort&&RelatedSeo().pullAndInject()})}}function Notifications(){var container=document.getElementById("toast-container");this.childrens=!!container?container.children:[]}Notifications.prototype.init=function(){for(var key in this.childrens){var child=this.childrens[key];var datasets=Object.assign({},child.dataset);var notiId=datasets.notiId;if(!!notiId){var notiTrigger=datasets.notiTrigger;var notiViews=datasets.notiViews==""?0:parseInt(datasets.notiViews);var notiDisplay=datasets.notiDisplay;var dataAttr="[data-noti-id='"+notiId+"']";(function(dataAttr,notiTrigger,notiDisplay,notiViews,notiId){setTimeout(function(){var liveNoti_c=0;if(typeof Storage!=="undefined"){var liveNoti_max=notiViews?notiViews:0;liveNoti_c=localStorage.getItem("liveNoti_c"+notiId);if(liveNoti_c){liveNoti_c=parseInt(liveNoti_c)}try{localStorage.setItem("liveNoti_c"+notiId,liveNoti_c+1)}catch(e){}}notiViews==0||liveNoti_c<notiViews?$bm(dataAttr).fadeIn():void 0;(function(){setTimeout(function(){$bm(dataAttr).fadeOut()},notiDisplay)})(notiDisplay)},notiTrigger)})(dataAttr,notiTrigger,notiDisplay,notiViews,notiId)}}$bm(".toast-close-button").addListener("click",function(e){e.preventDefault();var notiId=e.target.dataset.notiId;var dataAttr="[data-noti-id='"+notiId+"']";$bm(dataAttr).fadeOut()})};setTimeout(function(){var customNoti=new Notifications;customNoti.init()});function AskModal(){this.injected=false;this.isPulling=false;this.submitting=false}AskModal.prototype.listen=function(){var self=this;$bm(".btn-ask").addListener("click",function(e){e.preventDefault();self.toggleAskModal()})};AskModal.prototype.toggleAskModal=function(){global.loadinViewAction();this.modalAction()};AskModal.prototype.modalAction=function(){var self=this;!this.injected&&!this.isPulling&&this.inject(function(){self.toggleModal()});this.injected&&self.toggleModal()};AskModal.prototype.toggleModal=function(){$bm("body").toggleClass("modal-open");$bm(".ask-view").toggleClass("active");bloader.hide();this.listenFormActions()};AskModal.prototype.inject=function(callback){this.isPulling=true;var self=this;var css=domdata.baseUrl+"/themes/rupa/resources/css/product/components/ask.css?v="+domdata.jsVersion;var domUrl=domdata.baseUrl+"/dom/askmodal?m=0";$bm("document").loadCSS(css,function(){$bm("document").getInjectDOM(domUrl,"#ask-question-modal","append",function(){self.injected=true;callback()})})};AskModal.prototype.listenFormActions=function(){var submitButton=$bm("#ask-submit");var errorDomId="#ask-error";var submitDiv=$bm("#submit-div");var timeOut=null;var formInputs={contact_method:"",ask_query:"",ask_name:"",ask_email:"",ask_phone:""};var checkBoxs=["email-me","call-me"];var self=this;var submitAction=function(){formInputs.contact_method=document.getElementById(checkBoxs[0]).checked?"email":"phone";for(var key in formInputs){if(key!="contact_method"){formInputs[key]=document.getElementById(key).value}}formInputs["p_id"]=domdata.product_id;var url=domdata.baseUrl+"/ws/submitquestion";bloader.show();var isSubmitting=self.submitting;self.submitting=true;!isSubmitting&&$bm("document").postAjax(url,formInputs,function(res){try{var response=JSON.parse(res);if(response.status){self.submitting=false;askModal.toggleModal();setTimeout(function(){notify.show("Thanks for your question. We will be in touch with you shortly, latest within 24 hours.")},500);setTimeout(function(){notify.hide()},5e3)}}catch(e){}bloader.hide()},"application/json;charset=UTF-8")};var init=function(){document.getElementById(checkBoxs[0]).checked=true;document.getElementById(checkBoxs[1]).checked=false;for(var key in formInputs){var dom=document.getElementById(key);dom?dom.value="":void 0}$bm("#call-me").addListener("click",function(e){var _toCheck=e.target.checked;$bm(".ask-h").removeClass("call-mode");_toCheck&&$bm(".ask-h").addClass("call-mode")});$bm("#email-me").addListener("click",function(e){$bm(".ask-h").removeClass("call-mode")});$bm("#ask_query").addListener("keyup",function(e){e.preventDefault();var len=e.target.value.replace("https://www.bookmundi.com/ /","").length||0;if(len>=100){$bm(".ask_query_count").hideDOM()}else{$bm(".ask_query_count").showDOM()}$bm("document").injectDOM(".ask_query_count",len+" characters - please write minimum 100 characters","replace")});$bm("#ask_view_close").addListener("click",function(e){e.preventDefault();self.toggleModal()});$bm("#askq-check").addListener("change",function(e){e.preventDefault();var isChecked=e.target.checked;isChecked?$bm("#ask-submit").removeClass("disabled"):$bm("#ask-submit").addClass("disabled")})};var injectError=function(text){$bm("document").injectDOM(errorDomId,text,"replace");$bm(errorDomId).showDOM();text==""&&clearTimeout(timeOut)};var hideError=function(){timeOut=setTimeout(function(){injectError("");$bm(errorDomId).hideDOM()},5e3)};var isNotEmpty=function(key){var dom=document.getElementById(key);return dom.value.replace("/ /g","").length>0};function validateEmail(key){var email=document.getElementById(key).value;var re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(email)}function checkPhoneNumber(key){var _toCheck=document.getElementById("call-me").checked==true;if(!_toCheck)return true;return isNotEmpty(key)}function checkOnlyNumber(key){var _toCheck=document.getElementById("call-me").checked==true;var phone=document.getElementById(key).value;phone.replace("/ /g","").trim();if(checkPhoneNumber(key)&&_toCheck||phone.replace("/ /g","").length>0){return phone.match(/^[0-9\s\-\+]+$/)}return true}var checkMinMax=function(key){var dom=document.getElementById(key);var len=dom.value.replace("/ /g","").length;return len>=100&&len<=500};var validateForm=function(){var questionLengthError=isNotEmpty("ask_query");if(!questionLengthError){injectError("Question cannot be blank.");hideError();return}var questionLengthError=checkMinMax("ask_query");if(!questionLengthError){injectError("Question should be minimum 100 characters and maximum 500 characters.");hideError();return}var nameLengthError=isNotEmpty("ask_name");if(!nameLengthError){injectError("Name cannot be blank.");hideError();return}var emailLengthError=isNotEmpty("ask_name");if(!emailLengthError){injectError("Email cannot be blank.");hideError();return}var emailValid=validateEmail("ask_email");if(!emailValid){injectError("Please enter valid email address.");hideError();return}var phoneCheck=checkPhoneNumber("ask_phone");if(!phoneCheck){injectError("Please enter phone number.");hideError();return}var onlyNumber=checkOnlyNumber("ask_phone");if(!onlyNumber){injectError("Please enter valid phone number.");hideError();return}return true};var listenSubmit=function(){submitButton.addListener("click",function(e){e.preventDefault();hideError();if(validateForm()){submitAction()}})};init();listenSubmit()};var askModal=new AskModal;askModal.listen();function QnaAction(){this.qnaPulling=false;this.injected=false;this.qnaReadmoreLink=$bm("#qa-readmore");this.qnaRequest={product_id:domdata.product_id,page:1}}QnaAction.prototype.listenQnaLinkClicked=function(){var qnaTitleLink=$bm("#question-accordion>li>a");qnaTitleLink.addListener("click",function(event){event.preventDefault();this.parentNode.classList.toggle("active")})};QnaAction.prototype.listenQnaHelpfulLinkClicked=function(){var qnahelpful=$bm(".h-block>a");qnahelpful.addListener("click",function(event){event.preventDefault();var key=this.classList;var data=new Array;var count=0;var id=this.getAttribute("data-id");if(key=="upcount"){var upcount=1;if(this.children[1]){upcount=parseInt(this.children[1].innerText)+1}count=upcount;data={upcount:upcount,id:id}}else{var downcount=1;if(this.children[1]){downcount=parseInt(this.children[1].innerText)+1}count=downcount;data={downcount:downcount,id:id}}var localdata=localStorage.getItem("qna");var qa=localdata?JSON.parse(localdata):{};var qaCount=false;if(Object.keys(qa).length!=0&&qa[id]){qaCount=qa[id][key]?true:false}if(!qaCount){qa[id]=qa[id]?qa[id]:{};qa[id][key]=count;this.classList.add("not-link");localStorage.setItem("qna",JSON.stringify(qa))}else{this.classList.add("not-link");return}var parent=this;var requestData={qa:data};var url=domdata.baseUrl+"/faqs/ws/updatecount";$bm("document").postAjax(url,requestData,function(res){try{var response=JSON.parse(res);if(response.status){var parentDiv=event.target;if(parentDiv.classList!=key){parentDiv=parentDiv.parentElement}if(count==1){var voteDom="<span>"+count+"</span>";parentDiv.innerHTML+=voteDom}else{parentDiv.children[1].innerText=count}}}catch(e){}},"application/json;charset=UTF-8")})};QnaAction.prototype.listenQnaReadmoreLinkCLicked=function(){var self=this;this.qnaReadmoreLink.addListener("click",function(event){var url=domdata.baseUrl+"/products/ws/getfaqs";var requestData=self.qnaRequest;bloader.show();$bm("document").postAjax(url,requestData,function(res){try{var response=JSON.parse(res);if(response.status){var QaDom="";for(var i=0;i<response.faqs.length;i++){var faq=response.faqs[i];var answer=faq.answer.toString();QaDom+='<li><a href="javascript:void(0)"><strong class="q-title">';QaDom+=faq.question;QaDom+='</strong><span class="icon-arrow487"></span></a><div id="qna1" class="qna-ans">';QaDom+=answer.replace(/<[^>]*>/g,"");QaDom+='<div class="h-block"><a href="javascript:void(0)" class="upcount" data-id="';QaDom+=faq.id;QaDom+='"><i class="icon-thumb-up"></i>';if(parseInt(faq.upcount)>0){QaDom+="<span>";QaDom+=faq.upcount;QaDom+="</span>"}QaDom+='</a><a href="javascript:void(0)" class="downcount" data-id="';QaDom+=faq.id;QaDom+='"><i class="icon-dislike-thumb"></i>';if(parseInt(faq.downcount)>0){QaDom+="<span>";QaDom+=faq.downcount;QaDom+="</span>"}QaDom+="</a></div></li>"}$bm("document").injectDOM("#question-accordion",QaDom,"append");var listCount=self.qnaRequest.page*5+5;if(listCount>=response.count){self.qnaReadmoreLink.removeDOM();var askDom='<a href="javascript:void(0)" class="btn btn-ask" id="btn-qna-ask">Ask a question</a>';$bm("document").injectDOM(".btn-more",askDom,"append");qnaAction.listenAskQuestion()}qnaAction.listenQnaLinkClicked();qnaAction.listenQnaHelpfulLinkClicked();self.qnaRequest.page++}}catch(e){}bloader.hide()},"application/json;charset=UTF-8")})};QnaAction.prototype.listenAskQuestion=function(){$bm("#btn-qna-ask").addListener("click",function(e){e.preventDefault();askModal.toggleAskModal()})};var qnaAction=new QnaAction;qnaAction.listenQnaReadmoreLinkCLicked();qnaAction.listenQnaLinkClicked();qnaAction.listenQnaHelpfulLinkClicked();var isTouchDevice="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch;if(isTouchDevice){var swiper={touchStartX:0,touchEndX:0,minSwipePixels:30,detectionZone:undefined,swiperCallback:function(){},init:function(detectionZone,callback){swiper.swiperCallback=callback;detectionZone.addEventListener("touchstart",function(event){swiper.touchStartX=event.changedTouches[0].screenX},false);detectionZone.addEventListener("touchend",function(event){swiper.touchEndX=event.changedTouches[0].screenX;swiper.handleSwipeGesture()},false)},handleSwipeGesture:function(){var direction,moved;if(swiper.touchEndX<=swiper.touchStartX){moved=swiper.touchStartX-swiper.touchEndX;direction="left"}if(swiper.touchEndX>=swiper.touchStartX){moved=swiper.touchEndX-swiper.touchStartX;direction="right"}if(moved>swiper.minSwipePixels&&direction!=="undefined"){swiper.swipe(direction,moved)}},swipe:function(direction,movedPixels){var ret={};ret.direction=direction;ret.movedPixels=movedPixels;swiper.swiperCallback(ret)}};var gestureZone=document.getElementById("tour-carousel");swiper.init(gestureZone,function(e){var dir=e.direction;if(dir){if(dir=="left"){dir="prev";slider.handleImageChangeEvent(dir)}else if(dir=="right"){dir="next";slider.handleImageChangeEvent(dir)}}})}(function(){function SecondaryJsFiles(){this.cssImageFiles=[domdata.baseUrl+"/themes/rara/resources/css/search/toastr.css?v="+domdata.jsVersion,domdata.baseUrl+"/themes/rupa/resources/css/common/glightbox.min.css?v="+domdata.jsVersion];this.jsFiles=[domdata.baseUrl+"/themes/rupa/resources/src-js/search/glightbox.js?v="+domdata.jsVersion];this.isPulling=false}SecondaryJsFiles.prototype.listen=function(){var self=this;$bm("document").addListener("mousemove",handleMouseMove)};function handleMouseMove(){$bm("document").removeListener("mousemove",handleMouseMove);!sec.isPulling&&sec.pullCssFile();!sec.isPulling&&sec.pullJsFile(function(){var lightbox=GLightbox({touchNavigation:true,loopAtEnd:true,autoplayVideos:true})});sec.isPulling=true;loadDepartureRelatedFilesOnMouseMove()}function loadDepartureRelatedFilesOnMouseMove(){loadReactFiles(function(){});var dcss=domdata.baseUrl+"/themes/rupa/resources/css/product/book.css?v="+domdata.jsVersion;$bm("document").loadCSS(dcss,function(){});loadDatePickerFiles(function(){})}SecondaryJsFiles.prototype.pullCssFile=function(){for(var key in this.cssImageFiles){$bm("document").loadCSS(this.cssImageFiles[key],function(){})}};SecondaryJsFiles.prototype.pullJsFile=function(callback){var self=this;var count=this.jsFiles.length;for(var i=0;i<count;i++){(function(key,file,count){$bm("document").loadJS(file,function(){try{key==count-1?callback():""}catch(e){}})})(i,this.jsFiles[i],count)}};var sec=new SecondaryJsFiles;sec.listen()})();function Elevation(){this.data=[];this.trip_id=domdata.product_id;this.dataLists=[];this.elevationLists=[];this.destinationNameLists=[];this._showInFeet=false;this.ctx=null;this.windowSize=window.innerWidth||document.documentElement.clientWidth||document.getElementsByTagName("body")[0].clientWidth;this.graphContainer=document.getElementById("elevation-graph-container");this.newchart=new ElevationChartClass;this.newchart.initChartOptions()}Elevation.prototype.init=function(callback){try{this.ctx=document.getElementById("elevationChart").getContext("2d");chartView.pullFiles(function(){callback()})}catch(e){}};Elevation.prototype.pull=function(){var url=domdata.baseUrl+"/trekinfo/ws/elevation?trip_id="+this.trip_id;var self=this;return new Promise(function(resolve){$bm("document").get(url,function(res){try{self.data=JSON.parse(res);resolve()}catch(e){}})})};Elevation.prototype.set=function(){this.destinationNameLists=[];this.elevationLists=[];var data=this.data;this.dataLists=data;this._showInFeet=data.s_feet;for(var key in data.destinations){this.destinationNameLists.push(data.destinations[key].destination_name);try{var elevation=data.elevation.filter(function(elev){return data.destinations[key].destination_id==elev.destination_id})[0];if(!!elevation.elevation)this.elevationLists.push(Math.round(elevation.elevation))}catch(e){}}this.selectAltitudeType();return this};Elevation.prototype.selectAltitudeType=function(){var radios=document.getElementsByClassName("elevation-radio");for(var key in radios){if(radios[key].value=="f"&&this._showInFeet){radios[key].checked=true}if(radios[key].value=="m"&&!this._showInFeet){radios[key].checked=true}}};Elevation.prototype.draw=function(redraw){if(this.elevationLists.length>0){this.newchart.chartLabels=this.destinationNameLists;this.newchart.chartData=this.elevationLists;this.newchart.chartLabelText="";$bm(".elevation-graph").showDOM();chartTooltip();this.newchart.initilize();!redraw&&this.setChartWidth()}};Elevation.prototype.setChartWidth=function(){var chartWidth=this.windowSize>1199?720:this.windowSize>979?586:this.windowSize>767?475:345;var n=this.windowSize>1199?9:this.windowSize>979?7:this.windowSize>767?5:3;if(this.destinationNameLists.length>n){chartWidth=80*this.destinationNameLists.length}this.graphContainer.style.width=chartWidth+"px"};function ElevationChartClass(){this.elevationChart=null;this.chartType="line";this.chartLabelText="";this.chartLabels=[];this.chartData=[];this.chartStyles={backgroundColor:"#dff0da",borderColor:"rgba(0,0,0,0.2)",borderWidth:.35};this.chartOptions=null}ElevationChartClass.prototype.initChartOptions=function(){this.chartOptions={elements:{line:{tension:0}},title:{display:false},legend:{display:false},scales:{yAxes:[{gridLines:{color:"rgba(0, 0, 0, 0)",tickMarkLength:15},ticks:{display:false,fontSize:12,fontColor:"#000"}},{stacked:false,display:false}],xAxes:[{display:false,options:{events:["click"]},ticks:{fontColor:"#3eb368"}}]},responsive:true,maintainAspectRatio:false,layout:{padding:{left:40,right:40,top:40,bottom:0}},showAllTooltips:true,scaleShowLabels:false,scaleStepWidth:50,tooltips:{enabled:true,displayColors:false,backgroundColor:"rgba(0,0,0,0)",bodyFontColor:"#3eb368",bodyFontFamily:"'Roboto', Arial, 'Helvetica Neue', Helvetica, sans-serif",yAlign:"bottom",xAlign:"center",titleFontColor:"#3eb368",callbacks:{title:function(tooltipItem,data){return""},label:function(tooltipItem,data){return tooltipItem.xLabel},afterLabel:function(tooltipItem,data){var meterValue=data["datasets"][0]["data"][tooltipItem["index"]];try{var meters=meterValue.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" m";var feet=Math.round(meterValue*3.28084).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" ft";return elevation._showInFeet?feet:meters}catch(e){console.log(e);return data["datasets"][0]["data"][tooltipItem["index"]]+" meters"}}}}}};ElevationChartClass.prototype.initilize=function(){!!this.elevationChart&&this.elevationChart.destroy();this.elevationChart=new Chart(elevation.ctx,{type:this.chartType,data:{labels:elevation.newchart.chartLabels,datasets:[{label:elevation.newchart.chartLabelText,data:elevation.newchart.chartData,backgroundColor:this.chartStyles["backgroundColor"],borderColor:this.chartStyles["borderColor"],borderWidth:this.chartStyles["borderWidth"],pointBackgroundColor:"#3eb368",pointStyle:this.chartStyles["pointStyle"],pointRadius:3,spanGaps:false}]},options:this.chartOptions});setTimeout(function(){stickBar.init();bookingSticky.init()},1e3)};Elevation.prototype.listenToggleAction=function(){var self=this;$bm(".elevation-radio").addListener("click",function(e){self._showInFeet=e.target.value=="f";elevation.newchart.initChartOptions();elevation.newchart.initilize()})};var elevation=new Elevation;var hasElevationDom=document.getElementsByClassName("elevation-graph");if(typeof hasElevationDom!="undefined"){elevation.init(function(){elevation.pull().then(function(){elevation.set().draw(false)})});elevation.listenToggleAction()}var wishButton=$bm(".wishlist-link");var wishView=new WishView;$bm("document").addListener("mousemove",pullWishLists);function pullWishLists(){if(!wishView.pullingWishLists&&domdata.user_id!=""){wishView.pullingWishLists=true;var pullWishUrl=baseUrl+"/products/ws/getwishList?version=1";wishButton.get(pullWishUrl,function(res){wishView.pullingWishLists=false;wishView.wishLists=JSON.parse(res);wishView.selectWishLists(false)});$bm("document").removeListener("mousemove",pullWishLists)}}wishButton.addListener("click",function(e){e.preventDefault();domdata.user_id>0?wishView.updateWishList():global.openLogin()});function WishView(){this.trip_id=domdata.product_id;this.wishLists=[];this.pullingWishLists=false;this.selectedIcon='<i class="icon-heart-shape-silhouette hrt"></i>';this.notSelectedIcon='<i class="icon-heart-shape-outline hrt"></i>'}WishView.prototype.updateWishList=function(){var wishUrl=baseUrl+"/products/ws/updatewishlist?id="+this.trip_id;wishUrl+="&version=1";wishButton.get(wishUrl,function(res){wishView.selectWishLists(res)})};WishView.prototype.selectWishLists=function(individual){if(individual){try{individual=JSON.parse(individual);wishButton.setAttribute("data-tooltip",individual.added==1?"Added to wishlist":"Add to wishlist");individual.added==1?$bm("document").injectDOM('[data-wish-id="'+domdata.product_id+'"]',wishView.selectedIcon,"replace"):$bm("document").injectDOM('[data-wish-id="'+domdata.product_id+'"]',wishView.notSelectedIcon,"replace")}catch(e){console.log(e)}}else{if(wishView.wishLists.indexOf(this.trip_id.toString())>-1){var wishLists=wishView.wishLists;for(var key in wishLists){try{wishButton.setAttribute("data-tooltip","Added to wishlist");$bm("document").injectDOM('[data-wish-id="'+domdata.product_id+'"]',wishView.selectedIcon,"replace")}catch(e){}}}}};$bm("#scroll-to-iti").addListener("click",function(e){e.preventDefault();BMScrollTo.scrollVerticalToElementById(e.target.hash.replace("#",""),50)});;(function(){function b(a,d){(null===a||void 0===a)&&b.warn("Warning","You must pass your app key when you instantiate Pusher.");d=d||{};var c=this;this.key=a;this.config=b.Util.extend(b.getGlobalConfig(),d.cluster?b.getClusterConfig(d.cluster):{},d);this.channels=new b.Channels;this.global_emitter=new b.EventsDispatcher;this.sessionID=Math.floor(1E9*Math.random());this.timeline=new b.Timeline(this.key,this.sessionID,{cluster:this.config.cluster,features:b.Util.getClientFeatures(),params:this.config.timelineParams||{},limit:50,level:b.Timeline.INFO,version:b.VERSION});this.config.disableStats||(this.timelineSender=new b.TimelineSender(this.timeline,{host:this.config.statsHost,path:"/timeline/v2/jsonp"}));this.connection=new b.ConnectionManager(this.key,b.Util.extend({getStrategy:function(a){a=b.Util.extend({},c.config,a);return b.StrategyBuilder.build(b.getDefaultStrategy(a),a)},timeline:this.timeline,activityTimeout:this.config.activity_timeout,pongTimeout:this.config.pong_timeout,unavailableTimeout:this.config.unavailable_timeout},this.config,{encrypted:this.isEncrypted()}));this.connection.bind("connected",function(){c.subscribeAll();c.timelineSender&&c.timelineSender.send(c.connection.isEncrypted())});this.connection.bind("message",function(a){var d=0===a.event.indexOf("pusher_internal:");if(a.channel){var b=c.channel(a.channel);b&&b.handleEvent(a.event,a.data)}d||c.global_emitter.emit(a.event,a.data)});this.connection.bind("disconnected",function(){c.channels.disconnect()});this.connection.bind("error",function(a){b.warn("Error",a)});b.instances.push(this);this.timeline.info({instances:b.instances.length});b.isReady&&c.connect()}var c=b.prototype;b.instances=[];b.isReady=!1;b.debug=function(){b.log&&b.log(b.Util.stringify.apply(this,arguments))};b.warn=function(){var a=b.Util.stringify.apply(this,arguments);window.console&&(window.console.warn?window.console.warn(a):window.console.log&&window.console.log(a));b.log&&b.log(a)};b.ready=function(){b.isReady=!0;for(var a=0,d=b.instances.length;a<d;a++)b.instances[a].connect()};c.channel=function(a){return this.channels.find(a)};c.allChannels=function(){return this.channels.all()};c.connect=function(){this.connection.connect();if(this.timelineSender&&!this.timelineSenderTimer){var a=this.connection.isEncrypted(),d=this.timelineSender;this.timelineSenderTimer=new b.PeriodicTimer(6E4,function(){d.send(a)})}};c.disconnect=function(){this.connection.disconnect();this.timelineSenderTimer&&(this.timelineSenderTimer.ensureAborted(),this.timelineSenderTimer=null)};c.bind=function(a,d){this.global_emitter.bind(a,d);return this};c.bind_all=function(a){this.global_emitter.bind_all(a);return this};c.subscribeAll=function(){for(var a in this.channels.channels)this.channels.channels.hasOwnProperty(a)&&this.subscribe(a)};c.subscribe=function(a){a=this.channels.add(a,this);"connected"===this.connection.state&&a.subscribe();return a};c.unsubscribe=function(a){a=this.channels.remove(a);"connected"===this.connection.state&&a.unsubscribe()};c.send_event=function(a,d,b){return this.connection.send_event(a,d,b)};c.isEncrypted=function(){return"https:"===b.Util.getDocument().location.protocol?!0:Boolean(this.config.encrypted)};b.HTTP={};this.Pusher=b}).call(this);(function(){function b(a){window.clearTimeout(a)}function c(a){window.clearInterval(a)}function a(a,d,b,c){var k=this;this.clear=d;this.timer=a(function(){null!==k.timer&&(k.timer=c(k.timer))},b)}var d=a.prototype;d.isRunning=function(){return null!==this.timer};d.ensureAborted=function(){this.timer&&(this.clear(this.timer),this.timer=null)};Pusher.Timer=function(d,c){return new a(setTimeout,b,d,function(a){c();return null})};Pusher.PeriodicTimer=function(d,b){return new a(setInterval,c,d,function(a){b();return a})}}).call(this);(function(){Pusher.Util={now:function(){return Date.now?Date.now():(new Date).valueOf()},defer:function(b){return new Pusher.Timer(0,b)},extend:function(b){for(var c=1;c<arguments.length;c++){var a=arguments[c],d;for(d in a)b[d]=a[d]&&a[d].constructor&&a[d].constructor===Object?Pusher.Util.extend(b[d]||{},a[d]):a[d]}return b},stringify:function(){for(var b=["Pusher"],c=0;c<arguments.length;c++)"string"===typeof arguments[c]?b.push(arguments[c]):void 0===window.JSON?b.push(arguments[c].toString()):b.push(JSON.stringify(arguments[c]));return b.join(" : ")},arrayIndexOf:function(b,c){var a=Array.prototype.indexOf;if(null===b)return-1;if(a&&b.indexOf===a)return b.indexOf(c);for(var a=0,d=b.length;a<d;a++)if(b[a]===c)return a;return-1},objectApply:function(b,c){for(var a in b)Object.prototype.hasOwnProperty.call(b,a)&&c(b[a],a,b)},keys:function(b){var c=[];Pusher.Util.objectApply(b,function(a,d){c.push(d)});return c},values:function(b){var c=[];Pusher.Util.objectApply(b,function(a){c.push(a)});return c},apply:function(b,c,a){for(var d=0;d<b.length;d++)c.call(a||window,b[d],d,b)},map:function(b,c){for(var a=[],d=0;d<b.length;d++)a.push(c(b[d],d,b,a));return a},mapObject:function(b,c){var a={};Pusher.Util.objectApply(b,function(d,b){a[b]=c(d)});return a},filter:function(b,c){c=c||function(a){return!!a};for(var a=[],d=0;d<b.length;d++)c(b[d],d,b,a)&&a.push(b[d]);return a},filterObject:function(b,c){var a={};Pusher.Util.objectApply(b,function(d,h){if(c&&c(d,h,b,a)||Boolean(d))a[h]=d});return a},flatten:function(b){var c=[];Pusher.Util.objectApply(b,function(a,d){c.push([d,a])});return c},any:function(b,c){for(var a=0;a<b.length;a++)if(c(b[a],a,b))return!0;return!1},all:function(b,c){for(var a=0;a<b.length;a++)if(!c(b[a],a,b))return!1;return!0},method:function(b){var c=Array.prototype.slice.call(arguments,1);return function(a){return a[b].apply(a,c.concat(arguments))}},getWindow:function(){return window},getDocument:function(){return document},getNavigator:function(){return navigator},getLocalStorage:function(){try{return window.localStorage}catch(b){}},getClientFeatures:function(){return Pusher.Util.keys(Pusher.Util.filterObject({ws:Pusher.WSTransport,flash:Pusher.FlashTransport},function(b){return b.isSupported({})}))},addWindowListener:function(b,c){var a=Pusher.Util.getWindow();void 0!==a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)},removeWindowListener:function(b,c){var a=Pusher.Util.getWindow();void 0!==a.addEventListener?a.removeEventListener(b,c,!1):a.detachEvent("on"+b,c)},isXHRSupported:function(){var b=window.XMLHttpRequest;return Boolean(b)&&void 0!==(new b).withCredentials},isXDRSupported:function(b){b=b?"https:":"http:";var c=Pusher.Util.getDocument().location.protocol;return Boolean(window.XDomainRequest)&&c===b}}}).call(this);(function(){Pusher.VERSION="2.2.3";Pusher.PROTOCOL=7;Pusher.host="ws.pusherapp.com";Pusher.ws_port=80;Pusher.wss_port=443;Pusher.sockjs_host="sockjs.pusher.com";Pusher.sockjs_http_port=80;Pusher.sockjs_https_port=443;Pusher.sockjs_path="/pusher";Pusher.stats_host="stats.pusher.com";Pusher.channel_auth_endpoint="/pusher/auth";Pusher.channel_auth_transport="ajax";Pusher.activity_timeout=12E4;Pusher.pong_timeout=3E4;Pusher.unavailable_timeout=1E4;Pusher.cdn_http="http://js.pusher.com/";Pusher.cdn_https="https://js.pusher.com/";Pusher.dependency_suffix=".min";Pusher.getDefaultStrategy=function(b){return[[":def","ws_options",{hostUnencrypted:b.wsHost+":"+b.wsPort,hostEncrypted:b.wsHost+":"+b.wssPort}],[":def","wss_options",[":extend",":ws_options",{encrypted:!0}]],[":def","sockjs_options",{hostUnencrypted:b.httpHost+":"+b.httpPort,hostEncrypted:b.httpHost+":"+b.httpsPort,httpPath:b.httpPath}],[":def","timeouts",{loop:!0,timeout:15E3,timeoutLimit:6E4}],[":def","ws_manager",[":transport_manager",{lives:2,minPingDelay:1E4,maxPingDelay:b.activity_timeout}]],[":def","streaming_manager",[":transport_manager",{lives:2,minPingDelay:1E4,maxPingDelay:b.activity_timeout}]],[":def_transport","ws","ws",3,":ws_options",":ws_manager"],[":def_transport","wss","ws",3,":wss_options",":ws_manager"],[":def_transport","flash","flash",2,":ws_options",":ws_manager"],[":def_transport","sockjs","sockjs",1,":sockjs_options"],[":def_transport","xhr_streaming","xhr_streaming",1,":sockjs_options",":streaming_manager"],[":def_transport","xdr_streaming","xdr_streaming",1,":sockjs_options",":streaming_manager"],[":def_transport","xhr_polling","xhr_polling",1,":sockjs_options"],[":def_transport","xdr_polling","xdr_polling",1,":sockjs_options"],[":def","ws_loop",[":sequential",":timeouts",":ws"]],[":def","wss_loop",[":sequential",":timeouts",":wss"]],[":def","flash_loop",[":sequential",":timeouts",":flash"]],[":def","sockjs_loop",[":sequential",":timeouts",":sockjs"]],[":def","streaming_loop",[":sequential",":timeouts",[":if",[":is_supported",":xhr_streaming"],":xhr_streaming",":xdr_streaming"]]],[":def","polling_loop",[":sequential",":timeouts",[":if",[":is_supported",":xhr_polling"],":xhr_polling",":xdr_polling"]]],[":def","http_loop",[":if",[":is_supported",":streaming_loop"],[":best_connected_ever",":streaming_loop",[":delayed",4E3,[":polling_loop"]]],[":polling_loop"]]],[":def","http_fallback_loop",[":if",[":is_supported",":http_loop"],[":http_loop"],[":sockjs_loop"]]],[":def","strategy",[":cached",18E5,[":first_connected",[":if",[":is_supported",":ws"],b.encrypted?[":best_connected_ever",":ws_loop",[":delayed",2E3,[":http_fallback_loop"]]]:[":best_connected_ever",":ws_loop",[":delayed",2E3,[":wss_loop"]],[":delayed",5E3,[":http_fallback_loop"]]],[":if",[":is_supported",":flash"],[":best_connected_ever",":flash_loop",[":delayed",2E3,[":http_fallback_loop"]]],[":http_fallback_loop"]]]]]]]}}).call(this);(function(){Pusher.getGlobalConfig=function(){return{wsHost:Pusher.host,wsPort:Pusher.ws_port,wssPort:Pusher.wss_port,httpHost:Pusher.sockjs_host,httpPort:Pusher.sockjs_http_port,httpsPort:Pusher.sockjs_https_port,httpPath:Pusher.sockjs_path,statsHost:Pusher.stats_host,authEndpoint:Pusher.channel_auth_endpoint,authTransport:Pusher.channel_auth_transport,activity_timeout:Pusher.activity_timeout,pong_timeout:Pusher.pong_timeout,unavailable_timeout:Pusher.unavailable_timeout}};Pusher.getClusterConfig=function(b){return{wsHost:"ws-"+b+".pusher.com",httpHost:"sockjs-"+b+".pusher.com"}}}).call(this);(function(){function b(b){var a=function(a){Error.call(this,a);this.name=b};Pusher.Util.extend(a.prototype,Error.prototype);return a}Pusher.Errors={BadEventName:b("BadEventName"),RequestTimedOut:b("RequestTimedOut"),TransportPriorityTooLow:b("TransportPriorityTooLow"),TransportClosed:b("TransportClosed"),UnsupportedTransport:b("UnsupportedTransport"),UnsupportedStrategy:b("UnsupportedStrategy")}}).call(this);(function(){function b(a){this.callbacks=new c;this.global_callbacks=[];this.failThrough=a}function c(){this._callbacks={}}var a=b.prototype;a.bind=function(a,b,c){this.callbacks.add(a,b,c);return this};a.bind_all=function(a){this.global_callbacks.push(a);return this};a.unbind=function(a,b,c){this.callbacks.remove(a,b,c);return this};a.unbind_all=function(a,b){this.callbacks.remove(a,b);return this};a.emit=function(a,b){var c;for(c=0;c<this.global_callbacks.length;c++)this.global_callbacks[c](a,b);var e=this.callbacks.get(a);if(e&&0<e.length)for(c=0;c<e.length;c++)e[c].fn.call(e[c].context||window,b);else this.failThrough&&this.failThrough(a,b);return this};c.prototype.get=function(a){return this._callbacks["_"+a]};c.prototype.add=function(a,b,c){a="_"+a;this._callbacks[a]=this._callbacks[a]||[];this._callbacks[a].push({fn:b,context:c})};c.prototype.remove=function(a,b,c){!a&&!b&&!c?this._callbacks={}:(a=a?["_"+a]:Pusher.Util.keys(this._callbacks),b||c?Pusher.Util.apply(a,function(a){this._callbacks[a]=Pusher.Util.filter(this._callbacks[a]||[],function(a){return b&&b!==a.fn||c&&c!==a.context});0===this._callbacks[a].length&&delete this._callbacks[a]},this):Pusher.Util.apply(a,function(a){delete this._callbacks[a]},this))};Pusher.EventsDispatcher=b}).call(this);(function(){function b(a,d){this.lastId=0;this.prefix=a;this.name=d}var c=b.prototype;c.create=function(a){this.lastId++;var d=this.lastId,b=this.prefix+d,c=this.name+"["+d+"]",e=!1,g=function(){e||(a.apply(null,arguments),e=!0)};this[d]=g;return{number:d,id:b,name:c,callback:g}};c.remove=function(a){delete this[a.number]};Pusher.ScriptReceiverFactory=b;Pusher.ScriptReceivers=new b("_pusher_script_","Pusher.ScriptReceivers")}).call(this);(function(){function b(a){this.src=a}var c=b.prototype;c.send=function(a){var d=this,b="Error loading "+d.src;d.script=document.createElement("script");d.script.id=a.id;d.script.src=d.src;d.script.type="text/javascript";d.script.charset="UTF-8";d.script.addEventListener?(d.script.onerror=function(){a.callback(b)},d.script.onload=function(){a.callback(null)}):d.script.onreadystatechange=function(){("loaded"===d.script.readyState||"complete"===d.script.readyState)&&a.callback(null)};void 0===d.script.async&&document.attachEvent&&/opera/i.test(navigator.userAgent)?(d.errorScript=document.createElement("script"),d.errorScript.id=a.id+"_error",d.errorScript.text=a.name+"('"+b+"');",d.script.async=d.errorScript.async=!1):d.script.async=!0;var c=document.getElementsByTagName("head")[0];c.insertBefore(d.script,c.firstChild);d.errorScript&&c.insertBefore(d.errorScript,d.script.nextSibling)};c.cleanup=function(){this.script&&(this.script.onload=this.script.onerror=null,this.script.onreadystatechange=null);this.script&&this.script.parentNode&&this.script.parentNode.removeChild(this.script);this.errorScript&&this.errorScript.parentNode&&this.errorScript.parentNode.removeChild(this.errorScript);this.errorScript=this.script=null};Pusher.ScriptRequest=b}).call(this);(function(){function b(a){this.options=a;this.receivers=a.receivers||Pusher.ScriptReceivers;this.loading={}}var c=b.prototype;c.load=function(a,d){var b=this;if(b.loading[a]&&0<b.loading[a].length)b.loading[a].push(d);else{b.loading[a]=[d];var c=new Pusher.ScriptRequest(b.getPath(a)),e=b.receivers.create(function(d){b.receivers.remove(e);if(b.loading[a]){var k=b.loading[a];delete b.loading[a];for(var l=function(a){a||c.cleanup()},m=0;m<k.length;m++)k[m](d,l)}});c.send(e)}};c.getRoot=function(a){var d=Pusher.Util.getDocument().location.protocol;return(a&&a.encrypted||"https:"===d?this.options.cdn_https:this.options.cdn_http).replace(/\/*$/,"")+"/"+this.options.version};c.getPath=function(a,d){return this.getRoot(d)+"/"+a+this.options.suffix+".js"};Pusher.DependencyLoader=b}).call(this);(function(){function b(){Pusher.ready()}function c(a){document.body?a():setTimeout(function(){c(a)},0)}function a(){c(b)}Pusher.DependenciesReceivers=new Pusher.ScriptReceiverFactory("_pusher_dependencies","Pusher.DependenciesReceivers");Pusher.Dependencies=new Pusher.DependencyLoader({cdn_http:Pusher.cdn_http,cdn_https:Pusher.cdn_https,version:Pusher.VERSION,suffix:Pusher.dependency_suffix,receivers:Pusher.DependenciesReceivers});window.JSON?a():Pusher.Dependencies.load("json2",a)})();(function(){for(var b=String.fromCharCode,c=0;64>c;c++)"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(c);var a=function(a){var d=a.charCodeAt(0);return 128>d?a:2048>d?b(192|d>>>6)+b(128|d&63):b(224|d>>>12&15)+b(128|d>>>6&63)+b(128|d&63)},d=function(a){var d=[0,2,1][a.length%3];a=a.charCodeAt(0)<<16|(1<a.length?a.charCodeAt(1):0)<<8|(2<a.length?a.charCodeAt(2):0);return["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>18),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>12&63),2<=d?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>6&63),1<=d?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a&63)].join("")},h=window.btoa||function(a){return a.replace(/[\s\S]{1,3}/g,d)};Pusher.Base64={encode:function(d){return h(d.replace(/[^\x00-\x7F]/g,a))}}}).call(this);(function(){function b(a,b){this.url=a;this.data=b}function c(a){return Pusher.Util.mapObject(a,function(a){"object"===typeof a&&(a=JSON.stringify(a));return encodeURIComponent(Pusher.Base64.encode(a.toString()))})}var a=b.prototype;a.send=function(a){if(!this.request){var b=Pusher.Util.filterObject(this.data,function(a){return void 0!==a}),b=Pusher.Util.map(Pusher.Util.flatten(c(b)),Pusher.Util.method("join","=")).join("&");this.request=new Pusher.ScriptRequest(this.url+"/"+a.number+"?"+b);this.request.send(a)}};a.cleanup=function(){this.request&&this.request.cleanup()};Pusher.JSONPRequest=b}).call(this);(function(){function b(a,b,c){this.key=a;this.session=b;this.events=[];this.options=c||{};this.uniqueID=this.sent=0}var c=b.prototype;b.ERROR=3;b.INFO=6;b.DEBUG=7;c.log=function(a,b){a<=this.options.level&&(this.events.push(Pusher.Util.extend({},b,{timestamp:Pusher.Util.now()})),this.options.limit&&this.events.length>this.options.limit&&this.events.shift())};c.error=function(a){this.log(b.ERROR,a)};c.info=function(a){this.log(b.INFO,a)};c.debug=function(a){this.log(b.DEBUG,a)};c.isEmpty=function(){return 0===this.events.length};c.send=function(a,b){var c=this,f=Pusher.Util.extend({session:c.session,bundle:c.sent+1,key:c.key,lib:"js",version:c.options.version,cluster:c.options.cluster,features:c.options.features,timeline:c.events},c.options.params);c.events=[];a(f,function(a,g){a||c.sent++;b&&b(a,g)});return!0};c.generateUniqueID=function(){this.uniqueID++;return this.uniqueID};Pusher.Timeline=b}).call(this);(function(){function b(b,a){this.timeline=b;this.options=a||{}}b.prototype.send=function(b,a){var d=this;d.timeline.isEmpty()||d.timeline.send(function(a,f){var e=new Pusher.JSONPRequest("http"+(b?"s":"")+"://"+(d.host||d.options.host)+d.options.path,a),g=Pusher.ScriptReceivers.create(function(a,b){Pusher.ScriptReceivers.remove(g);e.cleanup();b&&b.host&&(d.host=b.host);f&&f(a,b)});e.send(g)},a)};Pusher.TimelineSender=b}).call(this);(function(){function b(a){this.strategies=a}function c(a,b,c){var h=Pusher.Util.map(a,function(a,d,h,f){return a.connect(b,c(d,f))});return{abort:function(){Pusher.Util.apply(h,d)},forceMinPriority:function(a){Pusher.Util.apply(h,function(b){b.forceMinPriority(a)})}}}function a(a){return Pusher.Util.all(a,function(a){return Boolean(a.error)})}function d(a){!a.error&&!a.aborted&&(a.abort(),a.aborted=!0)}var h=b.prototype;h.isSupported=function(){return Pusher.Util.any(this.strategies,Pusher.Util.method("isSupported"))};h.connect=function(b,d){return c(this.strategies,b,function(b,c){return function(h,f){(c[b].error=h)?a(c)&&d(!0):(Pusher.Util.apply(c,function(a){a.forceMinPriority(f.transport.priority)}),d(null,f))}})};Pusher.BestConnectedEverStrategy=b}).call(this);(function(){function b(a,b,d){this.strategy=a;this.transports=b;this.ttl=d.ttl||18E5;this.encrypted=d.encrypted;this.timeline=d.timeline}function c(a){return"pusherTransport"+(a?"Encrypted":"Unencrypted")}function a(a){var b=Pusher.Util.getLocalStorage();if(b)try{var h=b[c(a)];if(h)return JSON.parse(h)}catch(k){d(a)}return null}function d(a){var b=Pusher.Util.getLocalStorage();if(b)try{delete b[c(a)]}catch(d){}}var h=b.prototype;h.isSupported=function(){return this.strategy.isSupported()};h.connect=function(b,h){var g=this.encrypted,k=a(g),l=[this.strategy];if(k&&k.timestamp+this.ttl>=Pusher.Util.now()){var m=this.transports[k.transport];m&&(this.timeline.info({cached:!0,transport:k.transport,latency:k.latency}),l.push(new Pusher.SequentialStrategy([m],{timeout:2*k.latency+1E3,failFast:!0})))}var p=Pusher.Util.now(),n=l.pop().connect(b,function s(a,k){if(a)d(g),0<l.length?(p=Pusher.Util.now(),n=l.pop().connect(b,s)):h(a);else{var m=k.transport.name,t=Pusher.Util.now()-p,r=Pusher.Util.getLocalStorage();if(r)try{r[c(g)]=JSON.stringify({timestamp:Pusher.Util.now(),transport:m,latency:t})}catch(u){}h(null,k)}});return{abort:function(){n.abort()},forceMinPriority:function(a){b=a;n&&n.forceMinPriority(a)}}};Pusher.CachedStrategy=b}).call(this);(function(){function b(a,b){this.strategy=a;this.options={delay:b.delay}}var c=b.prototype;c.isSupported=function(){return this.strategy.isSupported()};c.connect=function(a,b){var c=this.strategy,f,e=new Pusher.Timer(this.options.delay,function(){f=c.connect(a,b)});return{abort:function(){e.ensureAborted();f&&f.abort()},forceMinPriority:function(b){a=b;f&&f.forceMinPriority(b)}}};Pusher.DelayedStrategy=b}).call(this);(function(){function b(a){this.strategy=a}var c=b.prototype;c.isSupported=function(){return this.strategy.isSupported()};c.connect=function(a,b){var c=this.strategy.connect(a,function(a,e){e&&c.abort();b(a,e)});return c};Pusher.FirstConnectedStrategy=b}).call(this);(function(){function b(a,b,c){this.test=a;this.trueBranch=b;this.falseBranch=c}var c=b.prototype;c.isSupported=function(){return(this.test()?this.trueBranch:this.falseBranch).isSupported()};c.connect=function(a,b){return(this.test()?this.trueBranch:this.falseBranch).connect(a,b)};Pusher.IfStrategy=b}).call(this);(function(){function b(a,b){this.strategies=a;this.loop=Boolean(b.loop);this.failFast=Boolean(b.failFast);this.timeout=b.timeout;this.timeoutLimit=b.timeoutLimit}var c=b.prototype;c.isSupported=function(){return Pusher.Util.any(this.strategies,Pusher.Util.method("isSupported"))};c.connect=function(a,b){var c=this,f=this.strategies,e=0,g=this.timeout,k=null,l=function(m,p){p?b(null,p):(e+=1,c.loop&&(e%=f.length),e<f.length?(g&&(g*=2,c.timeoutLimit&&(g=Math.min(g,c.timeoutLimit))),k=c.tryStrategy(f[e],a,{timeout:g,failFast:c.failFast},l)):b(!0))},k=this.tryStrategy(f[e],a,{timeout:g,failFast:this.failFast},l);return{abort:function(){k.abort()},forceMinPriority:function(b){a=b;k&&k.forceMinPriority(b)}}};c.tryStrategy=function(a,b,c,f){var e=null,g=null;0<c.timeout&&(e=new Pusher.Timer(c.timeout,function(){g.abort();f(!0)}));g=a.connect(b,function(a,b){if(!a||!e||!e.isRunning()||c.failFast)e&&e.ensureAborted(),f(a,b)});return{abort:function(){e&&e.ensureAborted();g.abort()},forceMinPriority:function(a){g.forceMinPriority(a)}}};Pusher.SequentialStrategy=b}).call(this);(function(){function b(a,b,c,e){this.name=a;this.priority=b;this.transport=c;this.options=e||{}}function c(a,b){Pusher.Util.defer(function(){b(a)});return{abort:function(){},forceMinPriority:function(){}}}var a=b.prototype;a.isSupported=function(){return this.transport.isSupported({encrypted:this.options.encrypted})};a.connect=function(a,b){if(this.isSupported()){if(this.priority<a)return c(new Pusher.Errors.TransportPriorityTooLow,b)}else return c(new Pusher.Errors.UnsupportedStrategy,b);var f=this,e=!1,g=this.transport.createConnection(this.name,this.priority,this.options.key,this.options),k=null,l=function(){g.unbind("initialized",l);g.connect()},m=function(){k=new Pusher.Handshake(g,function(a){e=!0;q();b(null,a)})},p=function(a){q();b(a)},n=function(){q();b(new Pusher.Errors.TransportClosed(g))},q=function(){g.unbind("initialized",l);g.unbind("open",m);g.unbind("error",p);g.unbind("closed",n)};g.bind("initialized",l);g.bind("open",m);g.bind("error",p);g.bind("closed",n);g.initialize();return{abort:function(){e||(q(),k?k.close():g.close())},forceMinPriority:function(a){e||f.priority<a&&(k?k.close():g.close())}}};Pusher.TransportStrategy=b}).call(this);(function(){function b(a,b,c){return a+(b.encrypted?"s":"")+"://"+(b.encrypted?b.hostEncrypted:b.hostUnencrypted)+c}function c(a,b){return"/app/"+a+("?protocol="+Pusher.PROTOCOL+"&client=js&version="+Pusher.VERSION+(b?"&"+b:""))}Pusher.URLSchemes={ws:{getInitial:function(a,d){return b("ws",d,c(a,"flash=false"))}},flash:{getInitial:function(a,d){return b("ws",d,c(a,"flash=true"))}},sockjs:{getInitial:function(a,c){return b("http",c,c.httpPath||"/pusher","")},getPath:function(a,b){return c(a)}},http:{getInitial:function(a,d){var h=(d.httpPath||"/pusher")+c(a);return b("http",d,h)}}}}).call(this);(function(){function b(a,b,c,f,e){Pusher.EventsDispatcher.call(this);this.hooks=a;this.name=b;this.priority=c;this.key=f;this.options=e;this.state="new";this.timeline=e.timeline;this.activityTimeout=e.activityTimeout;this.id=this.timeline.generateUniqueID()}var c=b.prototype;Pusher.Util.extend(c,Pusher.EventsDispatcher.prototype);c.handlesActivityChecks=function(){return Boolean(this.hooks.handlesActivityChecks)};c.supportsPing=function(){return Boolean(this.hooks.supportsPing)};c.initialize=function(){var a=this;a.timeline.info(a.buildTimelineMessage({transport:a.name+(a.options.encrypted?"s":"")}));a.hooks.beforeInitialize&&a.hooks.beforeInitialize();if(a.hooks.isInitialized())a.changeState("initialized");else if(a.hooks.file)a.changeState("initializing"),Pusher.Dependencies.load(a.hooks.file,function(b,c){if(a.hooks.isInitialized())a.changeState("initialized"),c(!0);else{if(b)a.onError(b);a.onClose();c(!1)}});else a.onClose()};c.connect=function(){var a=this;if(a.socket||"initialized"!==a.state)return!1;var b=a.hooks.urls.getInitial(a.key,a.options);try{a.socket=a.hooks.getSocket(b,a.options)}catch(c){return Pusher.Util.defer(function(){a.onError(c);a.changeState("closed")}),!1}a.bindListeners();Pusher.debug("Connecting",{transport:a.name,url:b});a.changeState("connecting");return!0};c.close=function(){return this.socket?(this.socket.close(),!0):!1};c.send=function(a){var b=this;return"open"===b.state?(Pusher.Util.defer(function(){b.socket&&b.socket.send(a)}),!0):!1};c.ping=function(){"open"===this.state&&this.supportsPing()&&this.socket.ping()};c.onOpen=function(){this.hooks.beforeOpen&&this.hooks.beforeOpen(this.socket,this.hooks.urls.getPath(this.key,this.options));this.changeState("open");this.socket.onopen=void 0};c.onError=function(a){this.emit("error",{type:"WebSocketError",error:a});this.timeline.error(this.buildTimelineMessage({error:a.toString()}))};c.onClose=function(a){a?this.changeState("closed",{code:a.code,reason:a.reason,wasClean:a.wasClean}):this.changeState("closed");this.unbindListeners();this.socket=void 0};c.onMessage=function(a){this.emit("message",a)};c.onActivity=function(){this.emit("activity")};c.bindListeners=function(){var a=this;a.socket.onopen=function(){a.onOpen()};a.socket.onerror=function(b){a.onError(b)};a.socket.onclose=function(b){a.onClose(b)};a.socket.onmessage=function(b){a.onMessage(b)};a.supportsPing()&&(a.socket.onactivity=function(){a.onActivity()})};c.unbindListeners=function(){this.socket&&(this.socket.onopen=void 0,this.socket.onerror=void 0,this.socket.onclose=void 0,this.socket.onmessage=void 0,this.supportsPing()&&(this.socket.onactivity=void 0))};c.changeState=function(a,b){this.state=a;this.timeline.info(this.buildTimelineMessage({state:a,params:b}));this.emit(a,b)};c.buildTimelineMessage=function(a){return Pusher.Util.extend({cid:this.id},a)};Pusher.TransportConnection=b}).call(this);(function(){function b(a){this.hooks=a}var c=b.prototype;c.isSupported=function(a){return this.hooks.isSupported(a)};c.createConnection=function(a,b,c,f){return new Pusher.TransportConnection(this.hooks,a,b,c,f)};Pusher.Transport=b}).call(this);(function(){Pusher.WSTransport=new Pusher.Transport({urls:Pusher.URLSchemes.ws,handlesActivityChecks:!1,supportsPing:!1,isInitialized:function(){return Boolean(window.WebSocket||window.MozWebSocket)},isSupported:function(){return Boolean(window.WebSocket||window.MozWebSocket)},getSocket:function(a){return new(window.WebSocket||window.MozWebSocket)(a)}});Pusher.FlashTransport=new Pusher.Transport({file:"flashfallback",urls:Pusher.URLSchemes.flash,handlesActivityChecks:!1,supportsPing:!1,isSupported:function(){try{return Boolean(new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(a){try{var b=Pusher.Util.getNavigator();return Boolean(b&&b.mimeTypes&&void 0!==b.mimeTypes["application/x-shockwave-flash"])}catch(c){return!1}}},beforeInitialize:function(){void 0===window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR&&(window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR=!0);window.WEB_SOCKET_SWF_LOCATION=Pusher.Dependencies.getRoot()+"/WebSocketMain.swf"},isInitialized:function(){return void 0!==window.FlashWebSocket},getSocket:function(a){return new FlashWebSocket(a)}});Pusher.SockJSTransport=new Pusher.Transport({file:"sockjs",urls:Pusher.URLSchemes.sockjs,handlesActivityChecks:!0,supportsPing:!1,isSupported:function(){return!0},isInitialized:function(){return void 0!==window.SockJS},getSocket:function(a,b){return new SockJS(a,null,{js_path:Pusher.Dependencies.getPath("sockjs",{encrypted:b.encrypted}),ignore_null_origin:b.ignoreNullOrigin})},beforeOpen:function(a,b){a.send(JSON.stringify({path:b}))}});var b={urls:Pusher.URLSchemes.http,handlesActivityChecks:!1,supportsPing:!0,isInitialized:function(){return Boolean(Pusher.HTTP.Socket)}},c=Pusher.Util.extend({getSocket:function(a){return Pusher.HTTP.getStreamingSocket(a)}},b),b=Pusher.Util.extend({getSocket:function(a){return Pusher.HTTP.getPollingSocket(a)}},b),a={file:"xhr",isSupported:Pusher.Util.isXHRSupported},d={file:"xdr",isSupported:function(a){return Pusher.Util.isXDRSupported(a.encrypted)}};Pusher.XHRStreamingTransport=new Pusher.Transport(Pusher.Util.extend({},c,a));Pusher.XDRStreamingTransport=new Pusher.Transport(Pusher.Util.extend({},c,d));Pusher.XHRPollingTransport=new Pusher.Transport(Pusher.Util.extend({},b,a));Pusher.XDRPollingTransport=new Pusher.Transport(Pusher.Util.extend({},b,d))}).call(this);(function(){function b(a,b,c){this.manager=a;this.transport=b;this.minPingDelay=c.minPingDelay;this.maxPingDelay=c.maxPingDelay;this.pingDelay=void 0}var c=b.prototype;c.createConnection=function(a,b,c,f){var e=this;f=Pusher.Util.extend({},f,{activityTimeout:e.pingDelay});var g=e.transport.createConnection(a,b,c,f),k=null,l=function(){g.unbind("open",l);g.bind("closed",m);k=Pusher.Util.now()},m=function(a){g.unbind("closed",m);1002===a.code||1003===a.code?e.manager.reportDeath():!a.wasClean&&k&&(a=Pusher.Util.now()-k,a<2*e.maxPingDelay&&(e.manager.reportDeath(),e.pingDelay=Math.max(a/2,e.minPingDelay)))};g.bind("open",l);return g};c.isSupported=function(a){return this.manager.isAlive()&&this.transport.isSupported(a)};Pusher.AssistantToTheTransportManager=b}).call(this);(function(){function b(a){this.options=a||{};this.livesLeft=this.options.lives||Infinity}var c=b.prototype;c.getAssistant=function(a){return new Pusher.AssistantToTheTransportManager(this,a,{minPingDelay:this.options.minPingDelay,maxPingDelay:this.options.maxPingDelay})};c.isAlive=function(){return 0<this.livesLeft};c.reportDeath=function(){this.livesLeft-=1};Pusher.TransportManager=b}).call(this);(function(){function b(a){return function(b){return[a.apply(this,arguments),b]}}function c(a,b){if(0===a.length)return[[],b];var h=d(a[0],b),f=c(a.slice(1),h[1]);return[[h[0]].concat(f[0]),f[1]]}function a(a,b){if("string"===typeof a[0]&&":"===a[0].charAt(0)){var h=b[a[0].slice(1)];if(1<a.length){if("function"!==typeof h)throw"Calling non-function "+a[0];var f=[Pusher.Util.extend({},b)].concat(Pusher.Util.map(a.slice(1),function(a){return d(a,Pusher.Util.extend({},b))[0]}));return h.apply(this,f)}return[h,b]}return c(a,b)}function d(b,c){if("string"===typeof b){var d;if("string"===typeof b&&":"===b.charAt(0)){d=c[b.slice(1)];if(void 0===d)throw"Undefined symbol "+b;d=[d,c]}else d=[b,c];return d}return"object"===typeof b&&b instanceof Array&&0<b.length?a(b,c):[b,c]}var h={ws:Pusher.WSTransport,flash:Pusher.FlashTransport,sockjs:Pusher.SockJSTransport,xhr_streaming:Pusher.XHRStreamingTransport,xdr_streaming:Pusher.XDRStreamingTransport,xhr_polling:Pusher.XHRPollingTransport,xdr_polling:Pusher.XDRPollingTransport},f={isSupported:function(){return!1},connect:function(a,b){var c=Pusher.Util.defer(function(){b(new Pusher.Errors.UnsupportedStrategy)});return{abort:function(){c.ensureAborted()},forceMinPriority:function(){}}}},e={extend:function(a,b,c){return[Pusher.Util.extend({},b,c),a]},def:function(a,b,c){if(void 0!==a[b])throw"Redefining symbol "+b;a[b]=c;return[void 0,a]},def_transport:function(a,b,c,d,e,n){var q=h[c];if(!q)throw new Pusher.Errors.UnsupportedTransport(c);c=(!a.enabledTransports||-1!==Pusher.Util.arrayIndexOf(a.enabledTransports,b))&&(!a.disabledTransports||-1===Pusher.Util.arrayIndexOf(a.disabledTransports,b))&&("flash"!==b||!0!==a.disableFlash)?new Pusher.TransportStrategy(b,d,n?n.getAssistant(q):q,Pusher.Util.extend({key:a.key,encrypted:a.encrypted,timeline:a.timeline,ignoreNullOrigin:a.ignoreNullOrigin},e)):f;d=a.def(a,b,c)[1];d.transports=a.transports||{};d.transports[b]=c;return[void 0,d]},transport_manager:b(function(a,b){return new Pusher.TransportManager(b)}),sequential:b(function(a,b){var c=Array.prototype.slice.call(arguments,2);return new Pusher.SequentialStrategy(c,b)}),cached:b(function(a,b,c){return new Pusher.CachedStrategy(c,a.transports,{ttl:b,timeline:a.timeline,encrypted:a.encrypted})}),first_connected:b(function(a,b){return new Pusher.FirstConnectedStrategy(b)}),best_connected_ever:b(function(){var a=Array.prototype.slice.call(arguments,1);return new Pusher.BestConnectedEverStrategy(a)}),delayed:b(function(a,b,c){return new Pusher.DelayedStrategy(c,{delay:b})}),"if":b(function(a,b,c,d){return new Pusher.IfStrategy(b,c,d)}),is_supported:b(function(a,b){return function(){return b.isSupported()}})};Pusher.StrategyBuilder={build:function(a,b){var c=Pusher.Util.extend({},e,b);return d(a,c)[1].strategy}}}).call(this);(function(){Pusher.Protocol={decodeMessage:function(b){try{var c=JSON.parse(b.data);if("string"===typeof c.data)try{c.data=JSON.parse(c.data)}catch(a){if(!(a instanceof SyntaxError))throw a;}return c}catch(d){throw{type:"MessageParseError",error:d,data:b.data};}},encodeMessage:function(b){return JSON.stringify(b)},processHandshake:function(b){b=this.decodeMessage(b);if("pusher:connection_established"===b.event){if(!b.data.activity_timeout)throw"No activity timeout specified in handshake";return{action:"connected",id:b.data.socket_id,activityTimeout:1E3*b.data.activity_timeout}}if("pusher:error"===b.event)return{action:this.getCloseAction(b.data),error:this.getCloseError(b.data)};throw"Invalid handshake";},getCloseAction:function(b){return 4E3>b.code?1002<=b.code&&1004>=b.code?"backoff":null:4E3===b.code?"ssl_only":4100>b.code?"refused":4200>b.code?"backoff":4300>b.code?"retry":"refused"},getCloseError:function(b){return 1E3!==b.code&&1001!==b.code?{type:"PusherError",data:{code:b.code,message:b.reason||b.message}}:null}}}).call(this);(function(){function b(a,b){Pusher.EventsDispatcher.call(this);this.id=a;this.transport=b;this.activityTimeout=b.activityTimeout;this.bindListeners()}var c=b.prototype;Pusher.Util.extend(c,Pusher.EventsDispatcher.prototype);c.handlesActivityChecks=function(){return this.transport.handlesActivityChecks()};c.send=function(a){return this.transport.send(a)};c.send_event=function(a,b,c){a={event:a,data:b};c&&(a.channel=c);Pusher.debug("Event sent",a);return this.send(Pusher.Protocol.encodeMessage(a))};c.ping=function(){this.transport.supportsPing()?this.transport.ping():this.send_event("pusher:ping",{})};c.close=function(){this.transport.close()};c.bindListeners=function(){var a=this,b={message:function(b){var c;try{c=Pusher.Protocol.decodeMessage(b)}catch(d){a.emit("error",{type:"MessageParseError",error:d,data:b.data})}if(void 0!==c){Pusher.debug("Event recd",c);switch(c.event){case"pusher:error":a.emit("error",{type:"PusherError",data:c.data});break;case"pusher:ping":a.emit("ping");break;case"pusher:pong":a.emit("pong")}a.emit("message",c)}},activity:function(){a.emit("activity")},error:function(b){a.emit("error",{type:"WebSocketError",error:b})},closed:function(b){c();b&&b.code&&a.handleCloseEvent(b);a.transport=null;a.emit("closed")}},c=function(){Pusher.Util.objectApply(b,function(b,c){a.transport.unbind(c,b)})};Pusher.Util.objectApply(b,function(b,c){a.transport.bind(c,b)})};c.handleCloseEvent=function(a){var b=Pusher.Protocol.getCloseAction(a);(a=Pusher.Protocol.getCloseError(a))&&this.emit("error",a);b&&this.emit(b)};Pusher.Connection=b}).call(this);(function(){function b(a,b){this.transport=a;this.callback=b;this.bindListeners()}var c=b.prototype;c.close=function(){this.unbindListeners();this.transport.close()};c.bindListeners=function(){var a=this;a.onMessage=function(b){a.unbindListeners();try{var c=Pusher.Protocol.processHandshake(b);"connected"===c.action?a.finish("connected",{connection:new Pusher.Connection(c.id,a.transport),activityTimeout:c.activityTimeout}):(a.finish(c.action,{error:c.error}),a.transport.close())}catch(f){a.finish("error",{error:f}),a.transport.close()}};a.onClosed=function(b){a.unbindListeners();var c=Pusher.Protocol.getCloseAction(b)||"backoff";b=Pusher.Protocol.getCloseError(b);a.finish(c,{error:b})};a.transport.bind("message",a.onMessage);a.transport.bind("closed",a.onClosed)};c.unbindListeners=function(){this.transport.unbind("message",this.onMessage);this.transport.unbind("closed",this.onClosed)};c.finish=function(a,b){this.callback(Pusher.Util.extend({transport:this.transport,action:a},b))};Pusher.Handshake=b}).call(this);(function(){function b(a,b){Pusher.EventsDispatcher.call(this);this.key=a;this.options=b||{};this.state="initialized";this.connection=null;this.encrypted=!!b.encrypted;this.timeline=this.options.timeline;this.connectionCallbacks=this.buildConnectionCallbacks();this.errorCallbacks=this.buildErrorCallbacks();this.handshakeCallbacks=this.buildHandshakeCallbacks(this.errorCallbacks);var c=this;Pusher.Network.bind("online",function(){c.timeline.info({netinfo:"online"});("connecting"===c.state||"unavailable"===c.state)&&c.retryIn(0)});Pusher.Network.bind("offline",function(){c.timeline.info({netinfo:"offline"});c.connection&&c.sendActivityCheck()});this.updateStrategy()}var c=b.prototype;Pusher.Util.extend(c,Pusher.EventsDispatcher.prototype);c.connect=function(){!this.connection&&!this.runner&&(this.strategy.isSupported()?(this.updateState("connecting"),this.startConnecting(),this.setUnavailableTimer()):this.updateState("failed"))};c.send=function(a){return this.connection?this.connection.send(a):!1};c.send_event=function(a,b,c){return this.connection?this.connection.send_event(a,b,c):!1};c.disconnect=function(){this.disconnectInternally();this.updateState("disconnected")};c.isEncrypted=function(){return this.encrypted};c.startConnecting=function(){var a=this,b=function(c,f){c?a.runner=a.strategy.connect(0,b):"error"===f.action?(a.emit("error",{type:"HandshakeError",error:f.error}),a.timeline.error({handshakeError:f.error})):(a.abortConnecting(),a.handshakeCallbacks[f.action](f))};a.runner=a.strategy.connect(0,b)};c.abortConnecting=function(){this.runner&&(this.runner.abort(),this.runner=null)};c.disconnectInternally=function(){this.abortConnecting();this.clearRetryTimer();this.clearUnavailableTimer();this.connection&&this.abandonConnection().close()};c.updateStrategy=function(){this.strategy=this.options.getStrategy({key:this.key,timeline:this.timeline,encrypted:this.encrypted})};c.retryIn=function(a){var b=this;b.timeline.info({action:"retry",delay:a});0<a&&b.emit("connecting_in",Math.round(a/1E3));b.retryTimer=new Pusher.Timer(a||0,function(){b.disconnectInternally();b.connect()})};c.clearRetryTimer=function(){this.retryTimer&&(this.retryTimer.ensureAborted(),this.retryTimer=null)};c.setUnavailableTimer=function(){var a=this;a.unavailableTimer=new Pusher.Timer(a.options.unavailableTimeout,function(){a.updateState("unavailable")})};c.clearUnavailableTimer=function(){this.unavailableTimer&&this.unavailableTimer.ensureAborted()};c.sendActivityCheck=function(){var a=this;a.stopActivityCheck();a.connection.ping();a.activityTimer=new Pusher.Timer(a.options.pongTimeout,function(){a.timeline.error({pong_timed_out:a.options.pongTimeout});a.retryIn(0)})};c.resetActivityCheck=function(){var a=this;a.stopActivityCheck();a.connection.handlesActivityChecks()||(a.activityTimer=new Pusher.Timer(a.activityTimeout,function(){a.sendActivityCheck()}))};c.stopActivityCheck=function(){this.activityTimer&&this.activityTimer.ensureAborted()};c.buildConnectionCallbacks=function(){var a=this;return{message:function(b){a.resetActivityCheck();a.emit("message",b)},ping:function(){a.send_event("pusher:pong",{})},activity:function(){a.resetActivityCheck()},error:function(b){a.emit("error",{type:"WebSocketError",error:b})},closed:function(){a.abandonConnection();a.shouldRetry()&&a.retryIn(1E3)}}};c.buildHandshakeCallbacks=function(a){var b=this;return Pusher.Util.extend({},a,{connected:function(a){b.activityTimeout=Math.min(b.options.activityTimeout,a.activityTimeout,a.connection.activityTimeout||Infinity);b.clearUnavailableTimer();b.setConnection(a.connection);b.socket_id=b.connection.id;b.updateState("connected",{socket_id:b.socket_id})}})};c.buildErrorCallbacks=function(){function a(a){return function(c){c.error&&b.emit("error",{type:"WebSocketError",error:c.error});a(c)}}var b=this;return{ssl_only:a(function(){b.encrypted=!0;b.updateStrategy();b.retryIn(0)}),refused:a(function(){b.disconnect()}),backoff:a(function(){b.retryIn(1E3)}),retry:a(function(){b.retryIn(0)})}};c.setConnection=function(a){this.connection=a;for(var b in this.connectionCallbacks)this.connection.bind(b,this.connectionCallbacks[b]);this.resetActivityCheck()};c.abandonConnection=function(){if(this.connection){this.stopActivityCheck();for(var a in this.connectionCallbacks)this.connection.unbind(a,this.connectionCallbacks[a]);a=this.connection;this.connection=null;return a}};c.updateState=function(a,b){var c=this.state;this.state=a;c!==a&&(Pusher.debug("State changed",c+" -> "+a),this.timeline.info({state:a,params:b}),this.emit("state_change",{previous:c,current:a}),this.emit(a,b))};c.shouldRetry=function(){return"connecting"===this.state||"connected"===this.state};Pusher.ConnectionManager=b}).call(this);(function(){function b(){Pusher.EventsDispatcher.call(this);var b=this;void 0!==window.addEventListener&&(window.addEventListener("online",function(){b.emit("online")},!1),window.addEventListener("offline",function(){b.emit("offline")},!1))}Pusher.Util.extend(b.prototype,Pusher.EventsDispatcher.prototype);b.prototype.isOnline=function(){return void 0===window.navigator.onLine?!0:window.navigator.onLine};Pusher.NetInfo=b;Pusher.Network=new b}).call(this);(function(){function b(){this.reset()}var c=b.prototype;c.get=function(a){return Object.prototype.hasOwnProperty.call(this.members,a)?{id:a,info:this.members[a]}:null};c.each=function(a){var b=this;Pusher.Util.objectApply(b.members,function(c,f){a(b.get(f))})};c.setMyID=function(a){this.myID=a};c.onSubscription=function(a){this.members=a.presence.hash;this.count=a.presence.count;this.me=this.get(this.myID)};c.addMember=function(a){null===this.get(a.user_id)&&this.count++;this.members[a.user_id]=a.user_info;return this.get(a.user_id)};c.removeMember=function(a){var b=this.get(a.user_id);b&&(delete this.members[a.user_id],this.count--);return b};c.reset=function(){this.members={};this.count=0;this.me=this.myID=null};Pusher.Members=b}).call(this);(function(){function b(a,b){Pusher.EventsDispatcher.call(this,function(b,c){Pusher.debug("No callbacks on "+a+" for "+b)});this.name=a;this.pusher=b;this.subscribed=!1}var c=b.prototype;Pusher.Util.extend(c,Pusher.EventsDispatcher.prototype);c.authorize=function(a,b){return b(!1,{})};c.trigger=function(a,b){if(0!==a.indexOf("client-"))throw new Pusher.Errors.BadEventName("Event '"+a+"' does not start with 'client-'");return this.pusher.send_event(a,b,this.name)};c.disconnect=function(){this.subscribed=!1};c.handleEvent=function(a,b){0===a.indexOf("pusher_internal:")?"pusher_internal:subscription_succeeded"===a&&(this.subscribed=!0,this.emit("pusher:subscription_succeeded",b)):this.emit(a,b)};c.subscribe=function(){var a=this;a.authorize(a.pusher.connection.socket_id,function(b,c){b?a.handleEvent("pusher:subscription_error",c):a.pusher.send_event("pusher:subscribe",{auth:c.auth,channel_data:c.channel_data,channel:a.name})})};c.unsubscribe=function(){this.pusher.send_event("pusher:unsubscribe",{channel:this.name})};Pusher.Channel=b}).call(this);(function(){function b(a,b){Pusher.Channel.call(this,a,b)}var c=b.prototype;Pusher.Util.extend(c,Pusher.Channel.prototype);c.authorize=function(a,b){return(new Pusher.Channel.Authorizer(this,this.pusher.config)).authorize(a,b)};Pusher.PrivateChannel=b}).call(this);(function(){function b(a,b){Pusher.PrivateChannel.call(this,a,b);this.members=new Pusher.Members}var c=b.prototype;Pusher.Util.extend(c,Pusher.PrivateChannel.prototype);c.authorize=function(a,b){var c=this;Pusher.PrivateChannel.prototype.authorize.call(c,a,function(a,e){if(!a){if(void 0===e.channel_data){Pusher.warn("Invalid auth response for channel '"+c.name+"', expected 'channel_data' field");b("Invalid auth response");return}var g=JSON.parse(e.channel_data);c.members.setMyID(g.user_id)}b(a,e)})};c.handleEvent=function(a,b){switch(a){case"pusher_internal:subscription_succeeded":this.members.onSubscription(b);this.subscribed=!0;this.emit("pusher:subscription_succeeded",this.members);break;case"pusher_internal:member_added":var c=this.members.addMember(b);this.emit("pusher:member_added",c);break;case"pusher_internal:member_removed":(c=this.members.removeMember(b))&&this.emit("pusher:member_removed",c);break;default:Pusher.PrivateChannel.prototype.handleEvent.call(this,a,b)}};c.disconnect=function(){this.members.reset();Pusher.PrivateChannel.prototype.disconnect.call(this)};Pusher.PresenceChannel=b}).call(this);(function(){function b(){this.channels={}}var c=b.prototype;c.add=function(a,b){if(!this.channels[a]){var c=this.channels,f;f=0===a.indexOf("private-")?new Pusher.PrivateChannel(a,b):0===a.indexOf("presence-")?new Pusher.PresenceChannel(a,b):new Pusher.Channel(a,b);c[a]=f}return this.channels[a]};c.all=function(a){return Pusher.Util.values(this.channels)};c.find=function(a){return this.channels[a]};c.remove=function(a){var b=this.channels[a];delete this.channels[a];return b};c.disconnect=function(){Pusher.Util.objectApply(this.channels,function(a){a.disconnect()})};Pusher.Channels=b}).call(this);(function(){Pusher.Channel.Authorizer=function(b,a){this.channel=b;this.type=a.authTransport;this.options=a;this.authOptions=(a||{}).auth||{}};Pusher.Channel.Authorizer.prototype={composeQuery:function(b){b="socket_id="+encodeURIComponent(b)+"&channel_name="+encodeURIComponent(this.channel.name);for(var a in this.authOptions.params)b+="&"+encodeURIComponent(a)+"="+encodeURIComponent(this.authOptions.params[a]);return b},authorize:function(b,a){return Pusher.authorizers[this.type].call(this,b,a)}};var b=1;Pusher.auth_callbacks={};Pusher.authorizers={ajax:function(b,a){var d;d=Pusher.XHR?new Pusher.XHR:window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");d.open("POST",this.options.authEndpoint,!0);d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var h in this.authOptions.headers)d.setRequestHeader(h,this.authOptions.headers[h]);d.onreadystatechange=function(){if(4===d.readyState)if(200===d.status){var b,c=!1;try{b=JSON.parse(d.responseText),c=!0}catch(g){a(!0,"JSON returned from webapp was invalid, yet status code was 200. Data was: "+d.responseText)}c&&a(!1,b)}else Pusher.warn("Couldn't get auth info from your webapp",d.status),a(!0,d.status)};d.send(this.composeQuery(b));return d},jsonp:function(c,a){void 0!==this.authOptions.headers&&Pusher.warn("Warn","To send headers with the auth request, you must use AJAX, rather than JSONP.");var d=b.toString();b++;var h=Pusher.Util.getDocument(),f=h.createElement("script");Pusher.auth_callbacks[d]=function(b){a(!1,b)};f.src=this.options.authEndpoint+"?callback="+encodeURIComponent("Pusher.auth_callbacks['"+d+"']")+"&"+this.composeQuery(c);d=h.getElementsByTagName("head")[0]||h.documentElement;d.insertBefore(f,d.firstChild)}}}).call(this);;PusherConnect();var presenceChannel;function PusherConnect(){if(debug||yii_test)var apikey="35d8fa96137c7a323b2c";else var apikey="a23e964a4702b6e6ff96";var pusher=new Pusher(apikey,{authEndpoint:baseUrl+"/duplex/default/pusherauth"});presenceChannel=pusher.subscribe("presence-duplex");presenceChannel.bind("pusher:subscription_succeeded",function(){updateOnlineMembers(presenceChannel.members)});presenceChannel.bind("pusher:member_added",function(member){updateOnlineMembers(presenceChannel.members)});presenceChannel.bind("pusher:member_removed",function(member){setTimeout(function(){updateOnlineMembers(presenceChannel.members)},15e3)});if(!!product_channel){var prodPresChannel=pusher.subscribe("presence-"+product_channel);prodPresChannel.bind("pusher:subscription_succeeded",function(){HandleChatActions().updateConsideringBooking(prodPresChannel)});prodPresChannel.bind("pusher:member_added",function(member){HandleChatActions().updateConsideringBooking(prodPresChannel)})}if(mychannel){var channel=pusher.subscribe(mychannel);channel.bind("new_message",function(message){HandleChatActions().updateMessage(message)});channel.bind("new_duplex_message",function(message){HandleChatActions().newUpdateMessage(message)});channel.bind("seen_new_message",function(message){HandleChatActions().updateSeenMessage(message)});channel.bind("new_offer",function(negotiation){HandleChatActions().updateOffer(negotiation)});channel.bind("offer_off",function(data){HandleChatActions().updateOfferOff(data)})}}function updateOnlineMembers(members){HandleChatActions().updateStatus(members);$bm(".isonline").hideDOM();$bm(".isnotonline").showDOMInline();try{for(var key in members.members){$bm("#online-"+key+", #online-ico-"+key+", #mob-online-"+key+", #mob-online-ico-"+key).showDOMInline();$bm("#notonline-"+key+", #notonline-ico-"+key+", #mob-notonline-"+key+", #mob-notonline-ico-"+key).hideDOM();$bm(".online-"+key+", .online-ico-"+key+", .mob-online-"+key+", .mob-online-ico-"+key).showDOMInline();$bm(".notonline-"+key+", .notonline-ico-"+key+", .mob-notonline-"+key+", .mob-notonline-ico-"+key).hideDOM()}}catch(e){}}function HandleChatActions(){return{updateStatus:function(members){typeof duplexComponent!="undefined"?duplexComponent.duplexUpdateActions().listenOnlineOffline(members):void 0;desktopStatusUpdate(members)},newUpdateMessage:function(message){updateMblMessageCounter()},updateMessage:function(message){typeof duplexComponent!="undefined"?duplexComponent.duplexUpdateActions().updateMessage(message):void 0;updateMblMessageCounter()},updateSeenMessage:function(message){typeof duplexComponent!="undefined"?duplexComponent.duplexUpdateActions().updateSeenMessage(message):void 0},updateOffer:function(negotiation){typeof duplexComponent!="undefined"?duplexComponent.duplexUpdateActions().updateOffer(negotiation):void 0;updateMblMessageCounter()},updateOfferOff:function(data){typeof duplexComponent!="undefined"?duplexComponent.duplexUpdateActions().updateOfferOff(data):void 0},updateConsideringBooking:function(prodPresChannel){consideringBooking(prodPresChannel)}}}function updateMblMessageCounter(){typeof messageCounter!="undefined"?messageCounter.increaseMessageCounter(1):void 0}function consideringBooking(prodPresChannel){try{var count=prodPresChannel.members.count;count-=1;count=count+activeChatCounts;var pc=false;if(typeof Storage!=="undefined"){pc=localStorage.getItem("presenceCount");if(pc){pc=parseInt(pc)}if(count>0||pc>0){pc=pc+1;if(pc>6){pc=0}try{localStorage.setItem("presenceCount",pc)}catch(e){}}}if(pc==activeOffers){count=count+(activeOffers-1)}if(count>=1){if(count==1){var cl="person is"}else{var cl="people are"}var msg='<span class="icon-man94"></span>'+count+" other "+cl+" considering this tour right now.";$bm("document").injectDOM(".con-block",msg,"replace");$bm(".con-block").addClass("active")}}catch(e){}}function desktopStatusUpdate(members){try{var activeAgoText=document.getElementById("agency_status").dataset.activeago;var ids=[];for(var key in members.members){ids.push(key)}var statusText=ids.indexOf(ag_id)>-1?"Online":activeAgoText;!!statusText&&$bm("#agency_status").changeInnerText(statusText,false)}catch(e){}}</script>
<script data-pagespeed-no-defer>var criteoPartnerID=55523;window.dataLayer=window.dataLayer||[];var cUserEmail='';dataLayerIndex=0;dataLayer[dataLayerIndex]={'email':cUserEmail};function criteoCollect(){var o={};for(var i=0;i<arguments.length;i++){var arg=arguments[i];if(typeof arg!="object")continue;for(var p in arg){if(arg.hasOwnProperty(p))o[p]=arg[p];}}return o;}